<!DOCTYPE html>
<html lang="en">
<head>
  <!-- View Transitions API -->
  <meta name="view-transition" content="same-origin">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VLFHH5CPGM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-VLFHH5CPGM');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Containerizing Your Rails Development with Docker + Dev Containers | Software Engineering consultant</title>
  
  <meta name="theme-color" content="#006cac">

  <link rel="canonical" href="http://localhost:4000/blog/containerizing-rails-dev-with-docker">
  <link rel="alternate" type="application/rss+xml" title="Software Engineering consultant" href="http://localhost:4000/feed.xml" />
  <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/assets/css/global.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/typography.css">

  <meta name="description"
    content="Zero-setup onboarding, reproducible environments, and fewer 'works on my machine' moments.">
  <meta name="keywords"
    content="Software Engineering consultant, programming consultant, Ruby web development, agile Ruby development, Ruby on Rails web design, RoR consulting, Ruby on Rails service, RoR consultant, Ruby on Rails NYC, Ruby on Rails expertise, web agency, ios application development, mobile, api, frontend, backend, development, software engineer partner, sf developer, sf ruby on rails, berling ruby consultant, london consultant">
  <meta name="author" content="Max Lukin">

  <!-- Theme initialization - prevent flash -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Containerizing Your Rails Development with Docker + Dev Containers | Software Engineering consultant</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Containerizing Your Rails Development with Docker + Dev Containers" />
<meta name="author" content="Max Lukin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Zero-setup onboarding, reproducible environments, and fewer ‚Äòworks on my machine‚Äô moments." />
<meta property="og:description" content="Zero-setup onboarding, reproducible environments, and fewer ‚Äòworks on my machine‚Äô moments." />
<link rel="canonical" href="http://localhost:4000/blog/containerizing-rails-dev-with-docker" />
<meta property="og:url" content="http://localhost:4000/blog/containerizing-rails-dev-with-docker" />
<meta property="og:site_name" content="Software Engineering consultant" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-04T12:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Containerizing Your Rails Development with Docker + Dev Containers" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Max Lukin"},"dateModified":"2025-09-04T12:00:00+03:00","datePublished":"2025-09-04T12:00:00+03:00","description":"Zero-setup onboarding, reproducible environments, and fewer ‚Äòworks on my machine‚Äô moments.","headline":"Containerizing Your Rails Development with Docker + Dev Containers","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/containerizing-rails-dev-with-docker"},"url":"http://localhost:4000/blog/containerizing-rails-dev-with-docker"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
  <!-- Main content wrapper -->
  <div class="main-wrapper centered">
    <main>
      <!-- Reading progress bar -->
<div class="reading-progress" id="reading-progress"></div>

<article class="post-article">
  <!-- Back navigation -->
  <a href="/blog" class="back-home">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1m2 13a2 2 0 0 1-2-2V7m2 13a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2m-4-3H9M7 16h6M7 12h10"/>
    </svg>
    <span>Blog</span>
  </a>

  <!-- Post header -->
  <header class="post-header">
    <h1 class="post-title">Containerizing Your Rails Development with Docker + Dev Containers</h1>
    <div class="post-meta">
      <time datetime="2025-09-04T12:00:00+03:00">Sep 4, 2025</time>
      
      
      
      <span>¬∑ 8 min read</span>
      
        <span>¬∑ Max Lukin</span>
      
      
        <span class="post-tags"><a href="/search?q=docker" class="tag">docker</a><a href="/search?q=devcontainers" class="tag">devcontainers</a><a href="/search?q=rails" class="tag">rails</a><a href="/search?q=mysql" class="tag">mysql</a><a href="/search?q=redis" class="tag">redis</a><a href="/search?q=dotenv" class="tag">dotenv</a><a href="/search?q=bundler" class="tag">bundler</a></span>
      
    </div>
  </header>

  <div class="post-body">
    <!-- Table of Contents (generated by JS for posts with 4+ headings) -->
    <aside class="toc-sidebar" id="toc-sidebar">
      <nav class="toc" id="toc">
        <div class="toc-title">Contents</div>
        <ul class="toc-list" id="toc-list"></ul>
      </nav>
    </aside>

    <!-- Post content -->
    <div class="prose post-content" id="post-content">
      <blockquote>
  <p><strong>TL;DR</strong>
Containerizing your Rails dev environment with Docker (and VS Code Dev Containers) gives every engineer a fast, identical setup: <strong>Ruby + Bundler + MySQL + Redis</strong> with one click. No more per‚Äëmachine MySQL installs, version drift, or ‚Äúit works on my laptop.‚Äù</p>
</blockquote>

<ul>
  <li><strong>Repo paths used below</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">/.devcontainer/Dockerfile</code> ‚Äì dev-only image</li>
      <li><code class="language-plaintext highlighter-rouge">/docker-compose.dev.yml</code> ‚Äì dev stack (app, MySQL, Redis)</li>
      <li><code class="language-plaintext highlighter-rouge">/config/database.yml</code> ‚Äì uses env vars (host, port, creds)</li>
      <li><code class="language-plaintext highlighter-rouge">/.env.example</code> ‚Üí copied to <code class="language-plaintext highlighter-rouge">.env</code> on first boot</li>
      <li><code class="language-plaintext highlighter-rouge">/bin/setup</code> ‚Äì idempotent bootstrap (optional but recommended)</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="why-containerize-local-development">Why containerize local development?</h2>

<table>
  <thead>
    <tr>
      <th>Benefit</th>
      <th>Why it matters</th>
      <th>Trade‚Äëoff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Instant onboarding</strong></td>
      <td>New devs open the repo and everything ‚Äújust runs.‚Äù</td>
      <td>Slightly larger first build; Docker Desktop required.</td>
    </tr>
    <tr>
      <td><strong>Reproducible environments</strong></td>
      <td>Everyone shares the same Ruby, MySQL, Redis, OS libs.</td>
      <td>You maintain Dockerfiles/Compose.</td>
    </tr>
    <tr>
      <td><strong>Isolation</strong></td>
      <td>No conflicts with system MySQL/Redis or multiple projects.</td>
      <td>File I/O can be slower than native (especially on macOS).</td>
    </tr>
    <tr>
      <td><strong>Parity with CI/Prod</strong></td>
      <td>Same images/services you ship are used in dev.</td>
      <td>Can tempt you to over‚Äëoptimize images early.</td>
    </tr>
    <tr>
      <td><strong>Easy cleanup</strong></td>
      <td><code class="language-plaintext highlighter-rouge">docker compose down -v</code> wipes everything clean.</td>
      <td>You must understand volumes vs. containers.</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="the-dev-stack">The dev stack</h2>

<h3 id="1-dev-only-dockerfile--devcontainerdockerfile">1) Dev-only Dockerfile ‚Äî <code class="language-plaintext highlighter-rouge">/.devcontainer/Dockerfile</code></h3>

<p>This keeps dev gems, installs to <code class="language-plaintext highlighter-rouge">/usr/local/bundle</code>, and doesn‚Äôt assume production secrets.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># .devcontainer/Dockerfile</span>
<span class="k">FROM</span><span class="s"> ruby:3.4.4-slim</span>

<span class="k">ENV</span><span class="s"> LANG=C.UTF-8 LC_ALL=C.UTF-8     BUNDLE_PATH=/usr/local/bundle BUNDLE_JOBS=4 BUNDLE_RETRY=3</span>

<span class="k">RUN </span>apt-get update <span class="nt">-qq</span> <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">--no-install-recommends</span> <span class="nt">-y</span>       ca-certificates curl bash tzdata libjemalloc2 libvips       default-mysql-client libmariadb3 build-essential git libpq-dev       libyaml-dev pkg-config default-libmysqlclient-dev     <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span> /var/cache/apt/archives

<span class="c"># Optional jemalloc preload</span>
<span class="k">RUN </span><span class="nb">echo</span> <span class="s2">"/usr/lib/</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span><span class="s2">-linux-gnu/libjemalloc.so.2"</span> <span class="o">&gt;</span> /etc/ld.so.preload <span class="o">||</span> <span class="nb">true</span>

<span class="k">WORKDIR</span><span class="s"> /workspaces/app</span>

<span class="c"># Install Bundler matching Gemfile.lock if present</span>
<span class="k">COPY</span><span class="s"> Gemfile Gemfile.lock ./</span>
<span class="k">RUN </span><span class="nb">set</span> <span class="nt">-eux</span><span class="p">;</span>   <span class="k">if </span><span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"BUNDLED WITH"</span> Gemfile.lock<span class="p">;</span> <span class="k">then     </span><span class="nv">v</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">awk</span> <span class="s1">'/BUNDLED WITH/{getline; gsub(/^ +/,""); print}'</span> Gemfile.lock<span class="si">)</span><span class="s2">"</span><span class="p">;</span>     gem <span class="nb">install </span>bundler <span class="nt">-v</span> <span class="s2">"</span><span class="nv">$v</span><span class="s2">"</span> <span class="nt">--no-document</span><span class="p">;</span>   <span class="k">else     </span>gem <span class="nb">install </span>bundler <span class="nt">--no-document</span><span class="p">;</span>   <span class="k">fi</span><span class="p">;</span>   bundle config <span class="nb">unset </span>without <span class="o">||</span> <span class="nb">true</span><span class="p">;</span>   bundle config <span class="nb">set </span>path <span class="s2">"</span><span class="nv">$BUNDLE_PATH</span><span class="s2">"</span><span class="p">;</span>   bundle <span class="nb">install</span> <span class="nt">--jobs</span> <span class="k">${</span><span class="nv">BUNDLE_JOBS</span><span class="k">}</span> <span class="nt">--retry</span> <span class="k">${</span><span class="nv">BUNDLE_RETRY</span><span class="k">}</span> <span class="o">||</span> <span class="nb">true</span>

<span class="c"># App code</span>
<span class="k">COPY</span><span class="s"> . .</span>

<span class="c"># Helpful default command for dev containers</span>
<span class="k">CMD</span><span class="s"> bash -lc 'bundle exec rails db:prepare &amp;&amp; bundle exec rails s -b 0.0.0.0 -p 3000'</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Why a dev‚Äëonly Dockerfile?</strong>
Your production Dockerfile often excludes <code class="language-plaintext highlighter-rouge">development/test</code> gems, precompiles assets, and assumes secrets. The dev image should keep <strong>dev gems</strong> (e.g., <code class="language-plaintext highlighter-rouge">debug</code>) and run comfortably without prod secrets.</p>
</blockquote>

<hr />

<h3 id="2-docker-compose-for-dev--docker-composedevyml">2) Docker Compose for dev ‚Äî <code class="language-plaintext highlighter-rouge">/docker-compose.dev.yml</code></h3>

<p>It wires up the Rails app, MySQL 8, and Redis 7. It also waits for MySQL to be healthy before starting Rails.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># docker-compose.dev.yml</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">.devcontainer/Dockerfile</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.:/workspaces/app:cached</span>
      <span class="pi">-</span> <span class="s">bundle_cache:/usr/local/bundle</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">RAILS_ENV</span><span class="pi">:</span> <span class="s">development</span>

      <span class="c1"># Match config/database.yml expectations</span>
      <span class="na">MYSQL_DB_HOST</span><span class="pi">:</span> <span class="s">mysql</span>
      <span class="na">MYSQL_DB_PORT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3306"</span>
      <span class="na">MYSQL_DB_USER</span><span class="pi">:</span> <span class="s">root</span>
      <span class="na">MYSQL_DB_PASS</span><span class="pi">:</span> <span class="s">password</span>
      <span class="na">MYSQL_NAME</span><span class="pi">:</span> <span class="s">wigiwork_development</span>

      <span class="na">REDIS_URL</span><span class="pi">:</span> <span class="s">redis://redis:6379/0</span>
      <span class="na">APP_VERSION</span><span class="pi">:</span> <span class="s">devcontainer</span>
      <span class="na">RAILS_LOG_TO_STDOUT</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">${RAILS_PORT:-3000}:3000"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="na">mysql</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_healthy</span>
      <span class="na">redis</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">service_started</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">&gt;</span>
      <span class="s">bash -lc "</span>
        <span class="s">until mysqladmin ping -hmysql -P3306 -uroot -ppassword &gt;/dev/null 2&gt;&amp;1; do</span>
          <span class="s">echo 'Waiting for MySQL...'; sleep 1;</span>
        <span class="s">done;</span>
        <span class="s">bundle exec rails db:prepare &amp;&amp;</span>
        <span class="s">bundle exec rails s -b 0.0.0.0 -p 3000</span>
      <span class="s">"</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">.env</span>

  <span class="na">mysql</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:8.4</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s">password</span>
      <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">wigiwork_development</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3307:3306"</span> <span class="c1"># host:container for host access</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">mysqladmin"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">ping"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-h"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">127.0.0.1"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-uroot"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-ppassword"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">5s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">5s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">20</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mysql_data:/var/lib/mysql</span>

  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:7</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">6380:6379"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis_data:/data</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">bundle_cache</span><span class="pi">:</span>
  <span class="na">mysql_data</span><span class="pi">:</span>
  <span class="na">redis_data</span><span class="pi">:</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note on volumes:</strong> the named volume <code class="language-plaintext highlighter-rouge">bundle_cache</code> persists Bundler gems across rebuilds. If the Gemfile changes groups (e.g., dev/test) or the cache gets stale, remove it:
<code class="language-plaintext highlighter-rouge">docker volume rm $(docker volume ls -q | grep bundle)</code> and rebuild.</p>
</blockquote>

<hr />

<h3 id="3-rails-db-config--configdatabaseyml">3) Rails DB config ‚Äî <code class="language-plaintext highlighter-rouge">/config/database.yml</code></h3>

<p>Use env vars and default the <strong>host to <code class="language-plaintext highlighter-rouge">mysql</code></strong> (the Compose service name).</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/database.yml</span>
<span class="na">default</span><span class="pi">:</span> <span class="nl">&amp;default</span>
  <span class="na">adapter</span><span class="pi">:</span> <span class="s">mysql2</span>
  <span class="na">encoding</span><span class="pi">:</span> <span class="s">utf8mb4</span>
  <span class="na">collation</span><span class="pi">:</span> <span class="s">utf8mb4_0900_ai_ci</span>
  <span class="na">pool</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("RAILS_MAX_THREADS", 5) %&gt;</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("MYSQL_DB_USER", "root") %&gt;</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("MYSQL_DB_PASS", "password") %&gt;</span>
  <span class="na">host</span><span class="pi">:</span>     <span class="s">&lt;%= ENV.fetch("MYSQL_DB_HOST", "mysql") %&gt;</span>
  <span class="na">port</span><span class="pi">:</span>     <span class="s">&lt;%= ENV.fetch("MYSQL_DB_PORT", "3306") %&gt;</span>
  <span class="na">variables</span><span class="pi">:</span>
    <span class="na">sql_mode</span><span class="pi">:</span> <span class="s">STRICT_ALL_TABLES</span>
  <span class="na">time_precision</span><span class="pi">:</span> <span class="m">6</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("MYSQL_NAME", "wigiwork_development") %&gt;</span>

<span class="na">test</span><span class="pi">:</span>
  <span class="na">&lt;&lt;</span><span class="pi">:</span> <span class="nv">*default</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">&lt;%= ENV.fetch("DB_DATABASE", "wigiwork_test") %&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>If you run Rails <strong>from the host</strong> against the containerized DB, use <code class="language-plaintext highlighter-rouge">127.0.0.1:3307</code> (not <code class="language-plaintext highlighter-rouge">mysql:3306</code>).
Example: <code class="language-plaintext highlighter-rouge">DATABASE_URL=mysql2://root:password@127.0.0.1:3307/wigiwork_development</code></p>
</blockquote>

<hr />

<h2 id="commands-youll-actually-use">Commands you‚Äôll actually use</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Validate compose (what Dev Containers runs under the hood)</span>
docker compose <span class="nt">-f</span> docker-compose.dev.yml config

<span class="c"># Build &amp; start everything in detached mode</span>
docker compose <span class="nt">-f</span> docker-compose.dev.yml up <span class="nt">-d</span> <span class="nt">--build</span>

<span class="c"># Exec into the app container</span>
docker compose <span class="nt">-f</span> docker-compose.dev.yml <span class="nb">exec </span>app bash

<span class="c"># Inside the container</span>
bundle <span class="nb">exec </span>rails db:prepare
rails s <span class="nt">-b</span> 0.0.0.0 <span class="nt">-p</span> 3000

<span class="c"># Start only MySQL (handy for host Rails or GUI tools)</span>
docker compose <span class="nt">-f</span> docker-compose.dev.yml up <span class="nt">-d</span> mysql

<span class="c"># Stop/start only the app</span>
docker compose <span class="nt">-f</span> docker-compose.dev.yml stop app
docker compose <span class="nt">-f</span> docker-compose.dev.yml start app

<span class="c"># View status and logs</span>
docker compose <span class="nt">-f</span> docker-compose.dev.yml ps
docker compose <span class="nt">-f</span> docker-compose.dev.yml logs <span class="nt">-f</span> app
</code></pre></div></div>

<p><strong>Detached mode?</strong> <code class="language-plaintext highlighter-rouge">-d</code> means containers run in the <strong>background</strong>; your terminal is free and logs aren‚Äôt attached. Use <code class="language-plaintext highlighter-rouge">logs -f</code> to tail when you need.</p>

<hr />

<h2 id="lessons-learned-from-real-debugging">Lessons learned (from real debugging)</h2>

<ul>
  <li>
    <p><strong>Empty port envs ‚Üí ‚Äúinvalid proto‚Äù</strong>
Always default your port mappings, e.g. <code class="language-plaintext highlighter-rouge">"${RAILS_PORT:-3000}:3000"</code>.</p>
  </li>
  <li>
    <p><strong>Environment syntax</strong>
In YAML map style use <code class="language-plaintext highlighter-rouge">KEY: value</code> (not <code class="language-plaintext highlighter-rouge">KEY=value</code>). This avoided errors like <code class="language-plaintext highlighter-rouge">could not find expected ':'</code>.</p>
  </li>
  <li>
    <p><strong>Dev gems must be installed</strong>
Excluding <code class="language-plaintext highlighter-rouge">development/test</code> caused <code class="language-plaintext highlighter-rouge">cannot load such file -- debug/prelude</code>. Keep dev gems in your <strong>dev image</strong>.</p>
  </li>
  <li>
    <p><strong>Dotenv 2.x vs 3.x API</strong>
<code class="language-plaintext highlighter-rouge">Dotenv.instrumenter=</code> was removed in 3.x. Either pin <code class="language-plaintext highlighter-rouge">dotenv-rails</code> to <code class="language-plaintext highlighter-rouge">~&gt; 2.8</code> or remove the old API usage.</p>
  </li>
  <li>
    <p><strong>Bundle cache volume can shadow image gems</strong>
If gems seem ‚Äúmissing‚Äù after a rebuild, delete the bundle volume and rebuild with <code class="language-plaintext highlighter-rouge">--no-cache</code>.</p>
  </li>
  <li><strong>Service discovery</strong>
    <ul>
      <li><strong>Inside containers</strong>: DB host is <code class="language-plaintext highlighter-rouge">mysql:3306</code>.</li>
      <li><strong>From host</strong>: DB is <code class="language-plaintext highlighter-rouge">127.0.0.1:3307</code> (published port).</li>
    </ul>
  </li>
  <li><strong>MySQL readiness</strong>
Use healthchecks plus a small wait loop before starting Rails.</li>
</ul>

<hr />

<h2 id="troubleshooting-cookbook">Troubleshooting cookbook</h2>

<p><strong>‚Äúinvalid proto:‚Äù in compose</strong>
‚Üí A port mapping used an empty env var. Add defaults: <code class="language-plaintext highlighter-rouge">- "${RAILS_PORT:-3000}:3000"</code>.</p>

<p><strong><code class="language-plaintext highlighter-rouge">cannot load such file -- debug/prelude</code></strong>
‚Üí Dev gems weren‚Äôt installed. Don‚Äôt set <code class="language-plaintext highlighter-rouge">bundle config set without 'development test'</code> for dev images.</p>

<p><strong><code class="language-plaintext highlighter-rouge">Dotenv NoMethodError: instrumenter=</code></strong>
‚Üí You‚Äôre on dotenv 3.x but using a 2.x method. Pin to <code class="language-plaintext highlighter-rouge">dotenv-rails ~&gt; 2.8</code> or remove that call.</p>

<p><strong><code class="language-plaintext highlighter-rouge">Could not find ‚Ä¶ in locally installed gems</code> after rebuild</strong>
‚Üí Your bundle cache volume is stale. Remove it and rebuild:
<code class="language-plaintext highlighter-rouge">docker volume rm &lt;bundle_volume&gt;; docker compose build --no-cache app</code>.</p>

<p><strong><code class="language-plaintext highlighter-rouge">Unknown MySQL server host 'mysql'</code> when running Rails on host</strong>
‚Üí From the host, use <code class="language-plaintext highlighter-rouge">127.0.0.1:3307</code>, not <code class="language-plaintext highlighter-rouge">mysql</code>.</p>

<hr />

<h2 id="pros--cons-recap">Pros &amp; cons recap</h2>

<p><strong>Pros</strong></p>
<ul>
  <li>‚úÖ Zero‚Äësetup onboarding; consistent environments</li>
  <li>‚úÖ Isolation from host toolchains</li>
  <li>‚úÖ CI/prod parity; easier ‚Äúit fails only in prod‚Äù bugs</li>
  <li>‚úÖ Fast resets (containers/volumes are disposable)</li>
</ul>

<p><strong>Cons</strong></p>
<ul>
  <li>‚ùå Slight perf overhead vs native (I/O heavy workloads)</li>
  <li>‚ùå Extra YAML/Dockerfiles to maintain</li>
  <li>‚ùå Requires Docker Desktop &amp; familiarity with containers</li>
</ul>

<hr />

<h2 id="final-checklist">Final checklist</h2>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Add <code class="language-plaintext highlighter-rouge">/.devcontainer/Dockerfile</code> and <code class="language-plaintext highlighter-rouge">/docker-compose.dev.yml</code>.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><code class="language-plaintext highlighter-rouge">config/database.yml</code> defaults to <code class="language-plaintext highlighter-rouge">host: mysql</code>, reads envs.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><code class="language-plaintext highlighter-rouge">.env.example</code> exists; copied to <code class="language-plaintext highlighter-rouge">.env</code> on first boot (or via <code class="language-plaintext highlighter-rouge">bin/setup</code>).</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><code class="language-plaintext highlighter-rouge">depends_on: condition: service_healthy</code> for MySQL + wait loop.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Use <code class="language-plaintext highlighter-rouge">bundle exec</code> for Rails commands.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Optional named volume for gems; remove it if cache causes issues.</li>
</ul>

<p>Happy shipping ‚Äî and goodbye to ‚Äúworks on my machine.‚Äù üöÄ</p>

    </div>
  </div>

  <!-- Post navigation (Previous/Next) -->
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      
      
      
      

  <nav class="post-navigation">
    
      <a href="/blog/acid_in_rails_postgresql_vs_mongodb" class="post-nav-link post-nav-prev">
        <span class="post-nav-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
          Older
        </span>
        <span class="post-nav-title">ACID in Rails PostgreSQL vs MongoDB - with...</span>
      </a>
    
    
      <a href="/blog/consolidating-rails-api-guide-for-cursor-ide" class="post-nav-link post-nav-next">
        <span class="post-nav-label">
          Newer
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"/>
            <polyline points="12 5 19 12 12 19"/>
          </svg>
        </span>
        <span class="post-nav-title">One Source of Truth: Consolidating Our Rails API...</span>
      </a>
    
  </nav>

  <!-- Back to top button -->
  <button id="back-to-top" class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="Back to top" aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="19" x2="12" y2="5"/>
      <polyline points="5 12 12 5 19 12"/>
    </svg>
  </button>
</article>

<script>
  // Show/hide back-to-top button based on scroll position
  const backToTop = document.getElementById('back-to-top');
  window.addEventListener('scroll', function() {
    if (window.scrollY > 400) {
      backToTop.classList.add('visible');
    } else {
      backToTop.classList.remove('visible');
    }
  });

  // Reading progress bar
  const progressBar = document.getElementById('reading-progress');
  const article = document.querySelector('.post-article');

  window.addEventListener('scroll', function() {
    const articleTop = article.offsetTop;
    const articleHeight = article.offsetHeight;
    const windowHeight = window.innerHeight;
    const scrolled = window.scrollY - articleTop + windowHeight * 0.3;
    const progress = Math.min(Math.max(scrolled / articleHeight * 100, 0), 100);
    progressBar.style.width = progress + '%';
  });

  // Generate Table of Contents
  const postContent = document.getElementById('post-content');
  const tocList = document.getElementById('toc-list');
  const tocSidebar = document.getElementById('toc-sidebar');
  const headings = postContent.querySelectorAll('h2, h3');

  if (headings.length >= 4) {
    tocSidebar.classList.add('visible');

    headings.forEach((heading, index) => {
      // Add ID to heading if not present
      if (!heading.id) {
        heading.id = 'heading-' + index;
      }

      const li = document.createElement('li');
      li.className = 'toc-item toc-' + heading.tagName.toLowerCase();

      const a = document.createElement('a');
      a.href = '#' + heading.id;
      a.textContent = heading.textContent;
      a.className = 'toc-link';

      li.appendChild(a);
      tocList.appendChild(li);
    });

    // Highlight current section in TOC
    const tocLinks = document.querySelectorAll('.toc-link');

    const observerOptions = {
      rootMargin: '-80px 0px -70% 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          tocLinks.forEach(link => link.classList.remove('active'));
          const activeLink = document.querySelector('.toc-link[href="#' + entry.target.id + '"]');
          if (activeLink) activeLink.classList.add('active');
        }
      });
    }, observerOptions);

    headings.forEach(heading => observer.observe(heading));
  }

  // Add copy buttons and language labels to code blocks
  document.querySelectorAll('.highlight, pre').forEach(element => {
    // Skip if already wrapped or if this is a pre inside a highlight we'll process
    if (element.closest('.code-block-wrapper')) return;
    if (element.tagName === 'PRE' && element.closest('.highlight')) return;

    // Determine what to wrap: the .highlight div or standalone pre
    const highlightDiv = element.classList.contains('highlight') ? element : null;
    const pre = highlightDiv ? highlightDiv.querySelector('pre') : element;
    if (!pre) return;

    const wrapper = document.createElement('div');
    wrapper.className = 'code-block-wrapper';

    // Wrap the highlight div if exists, otherwise wrap pre
    const toWrap = highlightDiv || pre;
    toWrap.parentNode.insertBefore(wrapper, toWrap);
    wrapper.appendChild(toWrap);

    // Detect language from class
    const code = pre.querySelector('code');
    let language = '';

    // Method 1: Check code element class
    if (code && code.className) {
      const match = code.className.match(/language-(\w+)/);
      if (match) language = match[1];
    }

    // Method 2: Check highlight div class (Rouge uses class like "highlight ruby")
    if (!language && highlightDiv) {
      const classes = highlightDiv.className.split(' ');
      for (const cls of classes) {
        if (cls !== 'highlight' && cls.length > 0 && !cls.startsWith('code')) {
          language = cls;
          break;
        }
      }
    }

    // Method 3: Try to detect from code patterns
    if (!language) {
      const text = pre.textContent.trim();
      if (text.startsWith('#') && !text.startsWith('#!/')) {
        const firstLine = text.split('\n')[0];
        if (firstLine.match(/\.rb$/)) language = 'ruby';
        else if (firstLine.match(/\.py$/)) language = 'python';
        else if (firstLine.match(/\.yml$|\.yaml$/)) language = 'yaml';
      } else if (text.startsWith('//')) {
        language = 'javascript';
      } else if (text.match(/^(RSpec|describe|it|context|let)\b/)) {
        language = 'ruby';
      } else if (text.match(/^(def |class |module |require )/)) {
        language = 'ruby';
      }
    }

    // Create header with language and copy button
    const header = document.createElement('div');
    header.className = 'code-block-header';

    if (language) {
      const langLabel = document.createElement('span');
      langLabel.className = 'code-lang';
      langLabel.textContent = language;
      header.appendChild(langLabel);
    }

    const copyBtn = document.createElement('button');
    copyBtn.className = 'code-copy-btn';
    copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
    copyBtn.onclick = async function() {
      const text = pre.textContent;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg><span>Copied!</span>';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    };
    header.appendChild(copyBtn);

    // Insert header at the start of wrapper (before the highlight/pre)
    wrapper.insertBefore(header, wrapper.firstChild);
  });
</script>

    </main>

    <footer class="site-footer">
      <div class="footer-content">
  <div class="footer-links">
    <a href="/feed.xml" title="RSS Feed" class="footer-icon-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 11a9 9 0 0 1 9 9"/>
        <path d="M4 4a16 16 0 0 1 16 16"/>
        <circle cx="5" cy="19" r="1"/>
      </svg>
    </a>
    <span class="footer-divider">¬∑</span>
    <button id="theme-btn" onclick="toggleTheme()" class="theme-toggle-btn" title="Toggle theme (press T)" aria-label="Toggle theme" aria-live="polite">
      <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"/>
      </svg>
      <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"/>
        <path d="M6.343 17.657l-1.414 1.414"/>
        <path d="M6.343 6.343l-1.414 -1.414"/>
        <path d="M17.657 6.343l1.414 -1.414"/>
        <path d="M17.657 17.657l1.414 1.414"/>
        <path d="M4 12h-2"/>
        <path d="M12 4v-2"/>
        <path d="M20 12h2"/>
        <path d="M12 20v2"/>
      </svg>
    </button>
  </div>
</div>

    </footer>
  </div>

  <script>
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      // Use View Transitions API if available
      if (document.startViewTransition) {
        document.startViewTransition(() => {
          html.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      } else {
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }
    }

    // Keyboard shortcut: press 't' to toggle theme
    document.addEventListener('keydown', function(e) {
      // Don't trigger if user is typing in an input/textarea
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
        return;
      }
      if (e.key === 't' || e.key === 'T') {
        toggleTheme();
      }
    });
  </script>
</body>
</html>
