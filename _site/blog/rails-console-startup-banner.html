<!DOCTYPE html>
<html lang="en">
<head>
  <!-- View Transitions API -->
  <meta name="view-transition" content="same-origin">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VLFHH5CPGM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-VLFHH5CPGM');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>A tiny Rails console banner that show app stats every time you run rails c | Software Engineering consultant</title>
  
  <meta name="theme-color" content="#006cac">

  <link rel="canonical" href="http://localhost:4000/blog/rails-console-startup-banner">
  <link rel="alternate" type="application/rss+xml" title="Software Engineering consultant" href="http://localhost:4000/feed.xml" />
  <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/assets/css/global.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/typography.css">

  <meta name="description"
    content="A tiny Rails console banner that show app stats every time you run rails c">
  <meta name="keywords"
    content="Software Engineering consultant, programming consultant, Ruby web development, agile Ruby development, Ruby on Rails web design, RoR consulting, Ruby on Rails service, RoR consultant, Ruby on Rails NYC, Ruby on Rails expertise, web agency, ios application development, mobile, api, frontend, backend, development, software engineer partner, sf developer, sf ruby on rails, berling ruby consultant, london consultant">
  <meta name="author" content="Max Lukin">

  <!-- Theme initialization - prevent flash -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>A tiny Rails console banner that show app stats every time you run rails c | Software Engineering consultant</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="A tiny Rails console banner that show app stats every time you run rails c" />
<meta name="author" content="Max Lukin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A tiny Rails console banner that show app stats every time you run rails c" />
<meta property="og:description" content="A tiny Rails console banner that show app stats every time you run rails c" />
<link rel="canonical" href="http://localhost:4000/blog/rails-console-startup-banner" />
<meta property="og:url" content="http://localhost:4000/blog/rails-console-startup-banner" />
<meta property="og:site_name" content="Software Engineering consultant" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-08-25T12:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="A tiny Rails console banner that show app stats every time you run rails c" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Max Lukin"},"dateModified":"2025-08-25T12:00:00+03:00","datePublished":"2025-08-25T12:00:00+03:00","description":"A tiny Rails console banner that show app stats every time you run rails c","headline":"A tiny Rails console banner that show app stats every time you run rails c","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/rails-console-startup-banner"},"url":"http://localhost:4000/blog/rails-console-startup-banner"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
  <!-- Main content wrapper -->
  <div class="main-wrapper centered">
    <main>
      <!-- Reading progress bar -->
<div class="reading-progress" id="reading-progress"></div>

<article class="post-article">
  <!-- Back navigation -->
  <a href="/blog" class="back-home">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1m2 13a2 2 0 0 1-2-2V7m2 13a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2m-4-3H9M7 16h6M7 12h10"/>
    </svg>
    <span>Blog</span>
  </a>

  <!-- Post header -->
  <header class="post-header">
    <h1 class="post-title">A tiny Rails console banner that show app stats every time you run rails c</h1>
    <div class="post-meta">
      <time datetime="2025-08-25T12:00:00+03:00">Aug 25, 2025</time>
      
      
      
      <span>· 6 min read</span>
      
        <span>· Max Lukin</span>
      
      
        <span class="post-tags"><a href="/search?q=rails-8" class="tag">rails-8</a><a href="/search?q=console" class="tag">console</a></span>
      
    </div>
  </header>

  <div class="post-body">
    <!-- Table of Contents (generated by JS for posts with 4+ headings) -->
    <aside class="toc-sidebar" id="toc-sidebar">
      <nav class="toc" id="toc">
        <div class="toc-title">Contents</div>
        <ul class="toc-list" id="toc-list"></ul>
      </nav>
    </aside>

    <!-- Post content -->
    <div class="prose post-content" id="post-content">
      <blockquote>
  <p>Quick win for everyday Rails work: print a small, colorized stats banner <strong>every time</strong> you open <code class="language-plaintext highlighter-rouge">rails console</code> — users, companies, profiles, attachments, etc. It’s zero‑maintenance and runs only in the console.</p>
</blockquote>

<h2 id="tldr--roadmap">TL;DR / Roadmap</h2>
<ol>
  <li><strong>Pick one approach</strong>:
    <ul>
      <li><strong>Option A — Initializer (console‑only)</strong>: <code class="language-plaintext highlighter-rouge">config/initializers/console_banner.rb</code></li>
      <li><strong>Option B — Console hook (bulletproof)</strong>: <code class="language-plaintext highlighter-rouge">config/console_banner.rb</code> + a small addition in <code class="language-plaintext highlighter-rouge">config/application.rb</code></li>
    </ul>
  </li>
  <li>Run <code class="language-plaintext highlighter-rouge">rails c</code> and enjoy the banner.</li>
  <li>If you use <strong>Spring</strong>, run <code class="language-plaintext highlighter-rouge">bin/spring stop</code> once (or <code class="language-plaintext highlighter-rouge">DISABLE_SPRING=1 rails c</code>) if you don’t see it the first time.</li>
  <li>Optional: colorize, add DB/Redis checks, or timing per query.</li>
</ol>

<hr />

<h2 id="why-this-exists">Why this exists</h2>
<p>When I open the console, I want context fast: <em>how many users are in the DB? which environment am I in? what database am I connected to?</em>
A tiny banner answers those in ~1ms of code you’ll forget about.</p>

<hr />

<h2 id="option-a--initializer-that-runs-only-in-the-console">Option A — Initializer that runs only in the console</h2>
<p>Create <strong><code class="language-plaintext highlighter-rouge">config/initializers/console_banner.rb</code></strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/initializers/console_banner.rb</span>
<span class="c1"># Prints a banner when you start `rails console` (and only then).</span>

<span class="k">if</span> <span class="k">defined?</span><span class="p">(</span><span class="no">Rails</span><span class="o">::</span><span class="no">Console</span><span class="p">)</span>
  <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">after_initialize</span> <span class="k">do</span>
    <span class="k">begin</span>
      <span class="c1"># Ensure DB is reachable</span>
      <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection</span>

      <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"Users"</span>          <span class="o">=&gt;</span> <span class="no">User</span><span class="p">,</span>
        <span class="s2">"Companies"</span>      <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">Company</span><span class="p">)</span> <span class="p">?</span> <span class="no">Company</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
        <span class="s2">"Profiles"</span>       <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">Profile</span><span class="p">)</span> <span class="p">?</span> <span class="no">Profile</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
        <span class="s2">"Resumes"</span>        <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">Resume</span><span class="p">)</span> <span class="p">?</span> <span class="no">Resume</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
        <span class="s2">"Attachments"</span>    <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Attachment</span><span class="p">)</span> <span class="p">?</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Attachment</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
        <span class="s2">"AccessRequests"</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">AccessRequest</span><span class="p">)</span> <span class="p">?</span> <span class="no">AccessRequest</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
      <span class="p">}.</span><span class="nf">compact</span>

      <span class="n">width</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nf">keys</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:length</span><span class="p">).</span><span class="nf">max</span>
      <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n\e</span><span class="s2">[1m--- Application Stats ---</span><span class="se">\e</span><span class="s2">[0m"</span>
      <span class="n">models</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">label</span><span class="p">,</span> <span class="n">klass</span><span class="o">|</span>
        <span class="n">count</span> <span class="o">=</span> <span class="k">begin</span>
          <span class="n">klass</span><span class="p">.</span><span class="nf">count</span>
        <span class="k">rescue</span> <span class="no">StandardError</span>
          <span class="s2">"N/A"</span>
        <span class="k">end</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Integer</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">count</span><span class="p">.</span><span class="nf">zero?</span><span class="p">)</span> <span class="p">?</span> <span class="mi">31</span> <span class="p">:</span> <span class="mi">32</span> <span class="c1"># red if 0, green otherwise</span>
        <span class="nb">printf</span> <span class="s2">"Total %-</span><span class="si">#{</span><span class="n">width</span><span class="si">}</span><span class="s2">s: </span><span class="se">\e</span><span class="s2">[</span><span class="si">#{</span><span class="n">color</span><span class="si">}</span><span class="s2">m%s</span><span class="se">\e</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">count</span>
      <span class="k">end</span>

      <span class="n">db_name</span> <span class="o">=</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection_db_config</span><span class="p">.</span><span class="nf">database</span> <span class="k">rescue</span> <span class="s2">"unknown"</span>
      <span class="nb">puts</span> <span class="s2">"Environment: </span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">env</span><span class="si">}</span><span class="s2"> | DB: </span><span class="si">#{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">"</span>
      <span class="nb">puts</span> <span class="s2">"---------------------------</span><span class="se">\n\n</span><span class="s2">"</span>
    <span class="k">rescue</span> <span class="no">StandardError</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">warn</span> <span class="s2">"[console banner] skipped: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Pros:</strong> minimal code, works in most setups.
<strong>Cons:</strong> very rare boot orders may skip it; see Option B if that happens.</p>

<hr />

<h2 id="option-b--console-hook-bulletproof">Option B — Console hook (bulletproof)</h2>
<p>1) Create <strong><code class="language-plaintext highlighter-rouge">config/console_banner.rb</code></strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/console_banner.rb</span>
<span class="k">module</span> <span class="nn">ConsoleBanner</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">print!</span>
    <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection</span>

    <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">"Users"</span>          <span class="o">=&gt;</span> <span class="no">User</span><span class="p">,</span>
      <span class="s2">"Companies"</span>      <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">Company</span><span class="p">)</span> <span class="p">?</span> <span class="no">Company</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
      <span class="s2">"Profiles"</span>       <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">Profile</span><span class="p">)</span> <span class="p">?</span> <span class="no">Profile</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
      <span class="s2">"Resumes"</span>        <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">Resume</span><span class="p">)</span> <span class="p">?</span> <span class="no">Resume</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
      <span class="s2">"Attachments"</span>    <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Attachment</span><span class="p">)</span> <span class="p">?</span> <span class="no">ActiveStorage</span><span class="o">::</span><span class="no">Attachment</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">),</span>
      <span class="s2">"AccessRequests"</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="k">defined?</span><span class="p">(</span><span class="no">AccessRequest</span><span class="p">)</span> <span class="p">?</span> <span class="no">AccessRequest</span> <span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>
    <span class="p">}.</span><span class="nf">compact</span>

    <span class="n">width</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nf">keys</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:length</span><span class="p">).</span><span class="nf">max</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n\e</span><span class="s2">[1m--- Application Stats ---</span><span class="se">\e</span><span class="s2">[0m"</span>
    <span class="n">models</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">label</span><span class="p">,</span> <span class="n">klass</span><span class="o">|</span>
      <span class="n">count</span> <span class="o">=</span> <span class="n">klass</span><span class="p">.</span><span class="nf">count</span> <span class="k">rescue</span> <span class="s2">"N/A"</span>
      <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Integer</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">count</span><span class="p">.</span><span class="nf">zero?</span><span class="p">)</span> <span class="p">?</span> <span class="mi">31</span> <span class="p">:</span> <span class="mi">32</span>
      <span class="nb">printf</span> <span class="s2">"Total %-</span><span class="si">#{</span><span class="n">width</span><span class="si">}</span><span class="s2">s: </span><span class="se">\e</span><span class="s2">[</span><span class="si">#{</span><span class="n">color</span><span class="si">}</span><span class="s2">m%s</span><span class="se">\e</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">count</span>
    <span class="k">end</span>

    <span class="n">db_name</span> <span class="o">=</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span><span class="p">.</span><span class="nf">connection_db_config</span><span class="p">.</span><span class="nf">database</span> <span class="k">rescue</span> <span class="s2">"unknown"</span>
    <span class="nb">puts</span> <span class="s2">"Environment: </span><span class="si">#{</span><span class="no">Rails</span><span class="p">.</span><span class="nf">env</span><span class="si">}</span><span class="s2"> | DB: </span><span class="si">#{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">"</span>
    <span class="nb">puts</span> <span class="s2">"---------------------------</span><span class="se">\n\n</span><span class="s2">"</span>
  <span class="k">rescue</span> <span class="no">StandardError</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">warn</span> <span class="s2">"[console banner] skipped: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">ConsoleBanner</span><span class="p">.</span><span class="nf">print!</span>
</code></pre></div></div>

<p>2) Register it in <strong><code class="language-plaintext highlighter-rouge">config/application.rb</code></strong> (inside <code class="language-plaintext highlighter-rouge">class Application &lt; Rails::Application</code>):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/application.rb</span>
<span class="k">module</span> <span class="nn">YourApp</span>
  <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
    <span class="c1"># ... other config</span>

    <span class="n">console</span> <span class="k">do</span>
      <span class="nb">require</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"config/console_banner"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Pros:</strong> guaranteed to run <strong>only</strong> in console and always load.
<strong>Cons:</strong> two small files instead of one.</p>

<hr />

<h2 id="example-what-it-looks-like">Example: What it looks like</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails c

--- Application Stats ---
  User Count (19.0ms)  SELECT COUNT(*) FROM `users` /*application='WigiworkBack'*/
Total Users         : 53
  Company Count (3.2ms)  SELECT COUNT(*) FROM `companies` /*application='WigiworkBack'*/
Total Companies     : 2
  Profile Count (0.3ms)  SELECT COUNT(*) FROM `profiles` /*application='WigiworkBack'*/
Total Profiles      : 52
  Resume Count (0.2ms)  SELECT COUNT(*) FROM `resumes` /*application='WigiworkBack'*/
Total Resumes       : 37
  ActiveStorage::Attachment Count (0.3ms)  SELECT COUNT(*) FROM `active_storage_attachments` /*application='WigiworkBack'*/
Total Attachments   : 0
  AccessRequest Count (0.2ms)  SELECT COUNT(*) FROM `access_requests` /*application='WigiworkBack'*/
Total AccessRequests: 4
Environment: development | DB: wigiwork_development
---------------------------

Loading development environment (Rails 8.0.2)
3.4.4 :001 &gt;
</code></pre></div></div>

<blockquote>
  <p>Note: The SQL lines appear if you have SQL logging enabled (default in development). The “green/red” colorization shown in the code depends on whether the count is zero.</p>
</blockquote>

<hr />

<h2 id="troubleshooting">Troubleshooting</h2>
<ul>
  <li><strong>Nothing prints?</strong>
    <ul>
      <li>Stop Spring: <code class="language-plaintext highlighter-rouge">bin/spring stop</code>, then <code class="language-plaintext highlighter-rouge">rails c</code>.</li>
      <li>Try <strong>Option B</strong> so the code is wired via the <code class="language-plaintext highlighter-rouge">console</code> hook.</li>
    </ul>
  </li>
  <li><strong>Errors about constant not defined?</strong>
    <ul>
      <li>Wrap optional models with <code class="language-plaintext highlighter-rouge">defined?(Model) ? Model : nil</code> (already done above).</li>
    </ul>
  </li>
  <li><strong>Production console</strong>
    <ul>
      <li>This also runs in production console; that’s usually fine. If you want it dev‑only, guard with <code class="language-plaintext highlighter-rouge">if Rails.env.development?</code>.</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="optional-enhancements">Optional enhancements</h2>
<ul>
  <li><strong>Timing per query:</strong> wrap <code class="language-plaintext highlighter-rouge">klass.count</code> in a small timer and print duration.</li>
  <li><strong>Health checks:</strong> ping Redis or Sidekiq before printing.</li>
  <li><strong>More models:</strong> add whatever gives you signal (e.g., <code class="language-plaintext highlighter-rouge">MessageThread</code>, <code class="language-plaintext highlighter-rouge">JobTitle</code>, etc.).</li>
</ul>

<hr />

<h2 id="how-youll-use-it-nothing-fancy">How you’ll use it (nothing fancy)</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/rails console
<span class="c"># or just</span>
rails c
</code></pre></div></div>

<hr />

<h2 id="steps-checklist">Steps checklist</h2>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Choose <strong>Option A</strong> (initializer) or <strong>Option B</strong> (console hook).</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Create the files at the exact paths above.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />(If using Spring) run <code class="language-plaintext highlighter-rouge">bin/spring stop</code> once.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><code class="language-plaintext highlighter-rouge">rails c</code> → confirm the banner displays.</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Extend with timers / health checks as needed.</li>
</ul>

    </div>
  </div>

  <!-- Post navigation (Previous/Next) -->
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      
      
      
      

  <nav class="post-navigation">
    
      <a href="/blog/rails-profile-endpoint-optimization-first-person" class="post-nav-link post-nav-prev">
        <span class="post-nav-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
          Older
        </span>
        <span class="post-nav-title">Optimizing a Complex Rails Profile Endpoint — my...</span>
      </a>
    
    
      <a href="/blog/acid_in_rails_postgresql_vs_mongodb" class="post-nav-link post-nav-next">
        <span class="post-nav-label">
          Newer
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"/>
            <polyline points="12 5 19 12 12 19"/>
          </svg>
        </span>
        <span class="post-nav-title">ACID in Rails PostgreSQL vs MongoDB - with...</span>
      </a>
    
  </nav>

  <!-- Back to top button -->
  <button id="back-to-top" class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="Back to top" aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="19" x2="12" y2="5"/>
      <polyline points="5 12 12 5 19 12"/>
    </svg>
  </button>
</article>

<script>
  // Show/hide back-to-top button based on scroll position
  const backToTop = document.getElementById('back-to-top');
  window.addEventListener('scroll', function() {
    if (window.scrollY > 400) {
      backToTop.classList.add('visible');
    } else {
      backToTop.classList.remove('visible');
    }
  });

  // Reading progress bar
  const progressBar = document.getElementById('reading-progress');
  const article = document.querySelector('.post-article');

  window.addEventListener('scroll', function() {
    const articleTop = article.offsetTop;
    const articleHeight = article.offsetHeight;
    const windowHeight = window.innerHeight;
    const scrolled = window.scrollY - articleTop + windowHeight * 0.3;
    const progress = Math.min(Math.max(scrolled / articleHeight * 100, 0), 100);
    progressBar.style.width = progress + '%';
  });

  // Generate Table of Contents
  const postContent = document.getElementById('post-content');
  const tocList = document.getElementById('toc-list');
  const tocSidebar = document.getElementById('toc-sidebar');
  const headings = postContent.querySelectorAll('h2, h3');

  if (headings.length >= 4) {
    tocSidebar.classList.add('visible');

    headings.forEach((heading, index) => {
      // Add ID to heading if not present
      if (!heading.id) {
        heading.id = 'heading-' + index;
      }

      const li = document.createElement('li');
      li.className = 'toc-item toc-' + heading.tagName.toLowerCase();

      const a = document.createElement('a');
      a.href = '#' + heading.id;
      a.textContent = heading.textContent;
      a.className = 'toc-link';

      li.appendChild(a);
      tocList.appendChild(li);
    });

    // Highlight current section in TOC
    const tocLinks = document.querySelectorAll('.toc-link');

    const observerOptions = {
      rootMargin: '-80px 0px -70% 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          tocLinks.forEach(link => link.classList.remove('active'));
          const activeLink = document.querySelector('.toc-link[href="#' + entry.target.id + '"]');
          if (activeLink) activeLink.classList.add('active');
        }
      });
    }, observerOptions);

    headings.forEach(heading => observer.observe(heading));
  }

  // Add copy buttons and language labels to code blocks
  document.querySelectorAll('.highlight, pre').forEach(element => {
    // Skip if already wrapped or if this is a pre inside a highlight we'll process
    if (element.closest('.code-block-wrapper')) return;
    if (element.tagName === 'PRE' && element.closest('.highlight')) return;

    // Determine what to wrap: the .highlight div or standalone pre
    const highlightDiv = element.classList.contains('highlight') ? element : null;
    const pre = highlightDiv ? highlightDiv.querySelector('pre') : element;
    if (!pre) return;

    const wrapper = document.createElement('div');
    wrapper.className = 'code-block-wrapper';

    // Wrap the highlight div if exists, otherwise wrap pre
    const toWrap = highlightDiv || pre;
    toWrap.parentNode.insertBefore(wrapper, toWrap);
    wrapper.appendChild(toWrap);

    // Detect language from class
    const code = pre.querySelector('code');
    let language = '';

    // Method 1: Check code element class
    if (code && code.className) {
      const match = code.className.match(/language-(\w+)/);
      if (match) language = match[1];
    }

    // Method 2: Check highlight div class (Rouge uses class like "highlight ruby")
    if (!language && highlightDiv) {
      const classes = highlightDiv.className.split(' ');
      for (const cls of classes) {
        if (cls !== 'highlight' && cls.length > 0 && !cls.startsWith('code')) {
          language = cls;
          break;
        }
      }
    }

    // Method 3: Try to detect from code patterns
    if (!language) {
      const text = pre.textContent.trim();
      if (text.startsWith('#') && !text.startsWith('#!/')) {
        const firstLine = text.split('\n')[0];
        if (firstLine.match(/\.rb$/)) language = 'ruby';
        else if (firstLine.match(/\.py$/)) language = 'python';
        else if (firstLine.match(/\.yml$|\.yaml$/)) language = 'yaml';
      } else if (text.startsWith('//')) {
        language = 'javascript';
      } else if (text.match(/^(RSpec|describe|it|context|let)\b/)) {
        language = 'ruby';
      } else if (text.match(/^(def |class |module |require )/)) {
        language = 'ruby';
      }
    }

    // Create header with language and copy button
    const header = document.createElement('div');
    header.className = 'code-block-header';

    if (language) {
      const langLabel = document.createElement('span');
      langLabel.className = 'code-lang';
      langLabel.textContent = language;
      header.appendChild(langLabel);
    }

    const copyBtn = document.createElement('button');
    copyBtn.className = 'code-copy-btn';
    copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
    copyBtn.onclick = async function() {
      const text = pre.textContent;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg><span>Copied!</span>';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    };
    header.appendChild(copyBtn);

    // Insert header at the start of wrapper (before the highlight/pre)
    wrapper.insertBefore(header, wrapper.firstChild);
  });
</script>

    </main>

    <footer class="site-footer">
      <div class="footer-content">
  <div class="footer-links">
    <a href="/feed.xml" title="RSS Feed" class="footer-icon-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 11a9 9 0 0 1 9 9"/>
        <path d="M4 4a16 16 0 0 1 16 16"/>
        <circle cx="5" cy="19" r="1"/>
      </svg>
    </a>
    <span class="footer-divider">·</span>
    <button id="theme-btn" onclick="toggleTheme()" class="theme-toggle-btn" title="Toggle theme (press T)" aria-label="Toggle theme" aria-live="polite">
      <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"/>
      </svg>
      <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"/>
        <path d="M6.343 17.657l-1.414 1.414"/>
        <path d="M6.343 6.343l-1.414 -1.414"/>
        <path d="M17.657 6.343l1.414 -1.414"/>
        <path d="M17.657 17.657l1.414 1.414"/>
        <path d="M4 12h-2"/>
        <path d="M12 4v-2"/>
        <path d="M20 12h2"/>
        <path d="M12 20v2"/>
      </svg>
    </button>
  </div>
</div>

    </footer>
  </div>

  <script>
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      // Use View Transitions API if available
      if (document.startViewTransition) {
        document.startViewTransition(() => {
          html.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      } else {
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }
    }

    // Keyboard shortcut: press 't' to toggle theme
    document.addEventListener('keydown', function(e) {
      // Don't trigger if user is typing in an input/textarea
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
        return;
      }
      if (e.key === 't' || e.key === 'T') {
        toggleTheme();
      }
    });
  </script>
</body>
</html>
