<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VLFHH5CPGM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-VLFHH5CPGM');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys | Software Engineering consultant</title>
  
  <meta name="theme-color" content="#020617">

  <link rel="canonical" href="http://localhost:4000/blog/securing-jwt-with-rsa-keys">
  <link rel="alternate" type="application/rss+xml" title="Software Engineering consultant" href="http://localhost:4000/feed.xml" />
  <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png">

  <link rel="stylesheet" href="/assets/css/styles.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              DEFAULT: '#38bdf8',
              foreground: '#0f172a'
            }
          }
        }
      }
    }
  </script>
  <meta name="description"
    content="Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys.">
  <meta name="keywords"
    content="Software Engineering consultant, programming consultant, Ruby web development, agile Ruby development, Ruby on Rails web design, RoR consulting, Ruby on Rails service, RoR consultant, Ruby on Rails NYC, Ruby on Rails expertise, web agency, ios application development, mobile, api, frontend, backend, development, software engineer partner, sf developer, sf ruby on rails, berling ruby consultant, london consultant">
  <meta name="author" content="Max Lukin">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys | Software Engineering consultant</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys" />
<meta name="author" content="Max Lukin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys." />
<meta property="og:description" content="Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys." />
<link rel="canonical" href="http://localhost:4000/blog/securing-jwt-with-rsa-keys" />
<meta property="og:url" content="http://localhost:4000/blog/securing-jwt-with-rsa-keys" />
<meta property="og:site_name" content="Software Engineering consultant" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-30T03:01:01+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Max Lukin"},"dateModified":"2025-07-30T03:01:01+03:00","datePublished":"2025-07-30T03:01:01+03:00","description":"Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys.","headline":"Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/securing-jwt-with-rsa-keys"},"url":"http://localhost:4000/blog/securing-jwt-with-rsa-keys"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body class="bg-slate-100 text-slate-900 font-sans antialiased">
    <div class="min-h-screen flex flex-col">
      <main class="flex-1">
        <div class="max-w-4xl mx-auto px-6 py-12 sm:py-16">
          <div class="rounded-[2.5rem] border border-white/60 bg-white/90 p-10 shadow-[0_30px_60px_-45px_rgba(15,23,42,0.45)] backdrop-blur">
            <div class="space-y-10">

  <div class="flex flex-wrap items-center justify-center gap-4 text-sm text-slate-500">
    <a href="/" class="group inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-4 py-2 font-medium uppercase tracking-[0.3em] text-slate-600 transition hover:border-brand hover:text-brand"
      title="Home">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 16 16"
        class="transition group-hover:-translate-y-px group-hover:text-brand">
        <path d="M8 4.5l-4 3.5V12a1 1 0 0 0 1 1h2.5v-2.5h1V13H11a1 1 0 0 0 1-1V8l-4-3.5z" fill="currentColor" />
        <path d="M2 8l6-5 6 5" stroke="currentColor" stroke-width="1.2" fill="none" />
      </svg>
      Home
    </a>

    <a href="/blog" class="inline-flex items-center gap-2 rounded-full border border-brand/30 bg-brand/10 px-4 py-2 text-sm font-semibold uppercase tracking-[0.3em] text-brand transition hover:border-brand hover:bg-brand/20"
      title="All Blog Posts">
      Other posts
    </a>
  </div>

  <article class="space-y-6">
    <header class="space-y-2">
      <h1 class="text-3xl font-semibold tracking-tight text-slate-900">Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys</h1>
      <p class="text-sm uppercase tracking-[0.3em] text-slate-500">Jul 30, 2025</p>
      <div class="h-px w-20 bg-gradient-to-r from-brand via-brand/40 to-transparent"></div>
    </header>

    <div class="prose prose-slate max-w-none prose-a:text-brand hover:prose-a:text-slate-900">
      <p>Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys.</p>

<p>In Rails API authentication, using JWT tokens with Devise and Devise-JWT provides simplicity and efficiency. But when security requirements become stricter, shared secrets (<code class="language-plaintext highlighter-rouge">HS256</code>) may not suffice. Instead, RSA asymmetric keys (<code class="language-plaintext highlighter-rouge">RS256</code>) provide stronger cryptographic protection by separating the token issuer (private key holder) from the verifier (public key holder).</p>

<h2 id="why-rsa-keys-instead-of-hs256">Why RSA Keys instead of HS256?</h2>

<ul>
  <li><strong>Asymmetric cryptography</strong>: Private keys sign tokens; public keys verify tokens.</li>
  <li><strong>Improved security</strong>: Private keys remain confidential, minimizing exposure risk.</li>
  <li><strong>Scalable and maintainable</strong>: Easily rotate keys without downtime or disruptions.</li>
</ul>

<hr />

<h2 id="step-by-step-implementation">Step-by-step implementation</h2>

<h3 id="1-generate-rsa-key-pair">1. Generate RSA key pair</h3>

<p>First, generate an RSA key pair:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rsa_private</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">generate</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
<span class="no">File</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s1">'jwt_rsa_private.pem'</span><span class="p">,</span> <span class="n">rsa_private</span><span class="p">.</span><span class="nf">to_pem</span><span class="p">)</span>
<span class="no">File</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s1">'jwt_rsa_public.pem'</span><span class="p">,</span> <span class="n">rsa_private</span><span class="p">.</span><span class="nf">public_key</span><span class="p">.</span><span class="nf">to_pem</span><span class="p">)</span>
</code></pre></div></div>

<p>Securely store these keys in Rails encrypted credentials (<code class="language-plaintext highlighter-rouge">rails credentials:edit</code>):</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">jwt_private_key</span><span class="pi">:</span> <span class="pi">|</span>
  <span class="s">-----BEGIN RSA PRIVATE KEY-----</span>
  <span class="s">your_private_key_here</span>
  <span class="s">-----END RSA PRIVATE KEY-----</span>

<span class="na">jwt_public_key</span><span class="pi">:</span> <span class="pi">|</span>
  <span class="s">-----BEGIN PUBLIC KEY-----</span>
  <span class="s">your_public_key_here</span>
  <span class="s">-----END PUBLIC KEY-----</span>
</code></pre></div></div>

<h3 id="2-configure-devise-jwt-for-rs256">2. Configure Devise-JWT for RS256</h3>

<p>Update your <code class="language-plaintext highlighter-rouge">config/initializers/devise.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Devise</span><span class="p">.</span><span class="nf">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">jwt</span> <span class="k">do</span> <span class="o">|</span><span class="n">jwt</span><span class="o">|</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">algorithm</span>  <span class="o">=</span> <span class="s1">'RS256'</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">secret</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
      <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">jwt_private_key</span>
    <span class="p">)</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">public_key</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
      <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">jwt_public_key</span>
    <span class="p">)</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">dispatch_requests</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">[</span><span class="s1">'POST'</span><span class="p">,</span> <span class="sr">%r{^/api/v1/sessions/sign_in$}</span><span class="p">],</span>
      <span class="p">[</span><span class="s1">'POST'</span><span class="p">,</span> <span class="sr">%r{^/api/v1/users$}</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">revocation_requests</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">[</span><span class="s1">'DELETE'</span><span class="p">,</span> <span class="sr">%r{^/api/v1/sessions/sign_out$}</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">expiration_time</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">to_i</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="3-configure-doorkeeper-jwt-optional-if-using-oauth2">3. Configure Doorkeeper-JWT (Optional, if using OAuth2)</h3>

<p>Ensure Doorkeeper-JWT issues tokens using the same RSA key:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/initializers/doorkeeper_jwt.rb</span>
<span class="no">Doorkeeper</span><span class="o">::</span><span class="no">JWT</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="n">token_payload</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="ss">:resource_owner_id</span><span class="p">])</span>
    <span class="p">{</span>
      <span class="ss">iss: </span><span class="s1">'my-rails-api'</span><span class="p">,</span>
      <span class="ss">sub: </span><span class="n">user</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span>
      <span class="ss">email: </span><span class="n">user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
      <span class="ss">scope: </span><span class="n">opts</span><span class="p">[</span><span class="ss">:scopes</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">secret_key</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
    <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">jwt_private_key</span>
  <span class="p">)</span>
  <span class="n">encryption_method</span> <span class="ss">:rs256</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="4-verify-rsa-based-jwt">4. Verify RSA-based JWT</h3>

<p>Your application now automatically issues and verifies JWT tokens using RSA keys. Token verification uses only the public key, keeping your private key secret and secure.</p>

<hr />

<h2 id="key-rotation">Key Rotation</h2>

<p>To rotate keys without downtime:</p>

<ol>
  <li>Generate a new RSA key pair.</li>
  <li>Temporarily add the new public key to your application’s configuration alongside the old one.</li>
  <li>Issue tokens with the new private key; verify tokens with both old and new public keys.</li>
  <li>After all older tokens expire, remove the old keys.</li>
</ol>

<p>Example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jwt</span><span class="p">.</span><span class="nf">public_key_set</span> <span class="o">=</span> <span class="p">[</span>
  <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">new_public_key</span><span class="p">),</span>
  <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">old_public_key</span><span class="p">)</span>
<span class="p">]</span>
</code></pre></div></div>

<hr />

<h2 id="test-via-curl">Test via cURL</h2>

<p>Sign-in example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST http://localhost:3000/api/v1/sessions/sign_in <span class="se">\</span>
<span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
<span class="nt">-d</span> <span class="s1">'{"user":{"email":"alice@example.com","password":"password123"}}'</span>
</code></pre></div></div>

<p>The response includes an RSA-signed JWT:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authorization: Bearer eyJhbGciOiJSUzI1NiJ9...
</code></pre></div></div>

<hr />

<p><strong>Conclusion</strong></p>

<p>Switching to RSA keys (<code class="language-plaintext highlighter-rouge">RS256</code>) strengthens JWT token security in your Rails API, clearly separating token generation and verification responsibilities and simplifying key management at scale.</p>

    </div>
  </article>
</div>

          </div>
        </div>
      </main>

      <footer class="bg-slate-100">
        <div class="max-w-4xl mx-auto px-6 py-8">
          <div class="flex justify-center">
  <a href="https://lukin.io/cv.pdf" target="_blank" title="Download CV"
    class="group inline-flex items-center gap-3 rounded-full border border-slate-200 bg-white px-6 py-3 text-sm font-semibold uppercase tracking-[0.2em] text-slate-600 transition hover:border-brand hover:text-brand">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 20 20"
      class="transition group-hover:translate-y-0.5 group-hover:text-brand">
      <g>
        <rect x="3" y="2" width="14" height="16" rx="2" fill="none" stroke="currentColor" stroke-width="1.5" />
        <path d="M10 7v6m0 0l-2.5-2.5M10 13l2.5-2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
          stroke-linejoin="round" fill="none" />
        <rect x="8" y="15" width="4" height="1.2" rx="0.6" fill="currentColor" />
      </g>
    </svg>
    <span class="transition group-hover:text-brand">Download CV</span>
  </a>
</div>

        </div>
      </footer>
    </div>
  </body>

</html>
