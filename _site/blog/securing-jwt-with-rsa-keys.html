<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VLFHH5CPGM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-VLFHH5CPGM');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys | Software Engineering consultant</title>
  
  <meta name="theme-color" content="#006cac">

  <link rel="canonical" href="http://localhost:4000/blog/securing-jwt-with-rsa-keys">
  <link rel="alternate" type="application/rss+xml" title="Software Engineering consultant" href="http://localhost:4000/feed.xml" />
  <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/assets/css/global.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/typography.css">

  <meta name="description"
    content="Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys.">
  <meta name="keywords"
    content="Software Engineering consultant, programming consultant, Ruby web development, agile Ruby development, Ruby on Rails web design, RoR consulting, Ruby on Rails service, RoR consultant, Ruby on Rails NYC, Ruby on Rails expertise, web agency, ios application development, mobile, api, frontend, backend, development, software engineer partner, sf developer, sf ruby on rails, berling ruby consultant, london consultant">
  <meta name="author" content="Max Lukin">

  <!-- Theme initialization - prevent flash -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys | Software Engineering consultant</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys" />
<meta name="author" content="Max Lukin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys." />
<meta property="og:description" content="Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys." />
<link rel="canonical" href="http://localhost:4000/blog/securing-jwt-with-rsa-keys" />
<meta property="og:url" content="http://localhost:4000/blog/securing-jwt-with-rsa-keys" />
<meta property="og:site_name" content="Software Engineering consultant" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-07-30T03:01:01+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Max Lukin"},"dateModified":"2025-07-30T03:01:01+03:00","datePublished":"2025-07-30T03:01:01+03:00","description":"Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys.","headline":"Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/securing-jwt-with-rsa-keys"},"url":"http://localhost:4000/blog/securing-jwt-with-rsa-keys"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
  <!-- Main content wrapper -->
  <div class="main-wrapper centered">
    <main>
      <article>
  <!-- Back navigation -->
  <a href="/blog" class="back-link">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="19" y1="12" x2="5" y2="12"/>
      <polyline points="12 19 5 12 12 5"/>
    </svg>
    <span>Back to all posts</span>
  </a>

  <!-- Post header -->
  <header style="margin-bottom: 2.5rem;">
    <h1 class="post-title">Securing JWT Tokens in Rails API with Devise, Devise-JWT, and RSA Keys</h1>
    <div class="post-meta">
      <time datetime="2025-07-30T03:01:01+03:00">July 30, 2025</time>
      
        <span>· Max Lukin</span>
      
      
        <span>· </span>
      
    </div>
  </header>

  <!-- Post content -->
  <div class="prose post-content">
    <p>Step-by-step guide to securing your Ruby on Rails API authentication using Devise, Devise-JWT, Doorkeeper-JWT, and RSA encryption keys.</p>

<p>In Rails API authentication, using JWT tokens with Devise and Devise-JWT provides simplicity and efficiency. But when security requirements become stricter, shared secrets (<code class="language-plaintext highlighter-rouge">HS256</code>) may not suffice. Instead, RSA asymmetric keys (<code class="language-plaintext highlighter-rouge">RS256</code>) provide stronger cryptographic protection by separating the token issuer (private key holder) from the verifier (public key holder).</p>

<h2 id="why-rsa-keys-instead-of-hs256">Why RSA Keys instead of HS256?</h2>

<ul>
  <li><strong>Asymmetric cryptography</strong>: Private keys sign tokens; public keys verify tokens.</li>
  <li><strong>Improved security</strong>: Private keys remain confidential, minimizing exposure risk.</li>
  <li><strong>Scalable and maintainable</strong>: Easily rotate keys without downtime or disruptions.</li>
</ul>

<hr />

<h2 id="step-by-step-implementation">Step-by-step implementation</h2>

<h3 id="1-generate-rsa-key-pair">1. Generate RSA key pair</h3>

<p>First, generate an RSA key pair:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rsa_private</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">generate</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
<span class="no">File</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s1">'jwt_rsa_private.pem'</span><span class="p">,</span> <span class="n">rsa_private</span><span class="p">.</span><span class="nf">to_pem</span><span class="p">)</span>
<span class="no">File</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s1">'jwt_rsa_public.pem'</span><span class="p">,</span> <span class="n">rsa_private</span><span class="p">.</span><span class="nf">public_key</span><span class="p">.</span><span class="nf">to_pem</span><span class="p">)</span>
</code></pre></div></div>

<p>Securely store these keys in Rails encrypted credentials (<code class="language-plaintext highlighter-rouge">rails credentials:edit</code>):</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">jwt_private_key</span><span class="pi">:</span> <span class="pi">|</span>
  <span class="s">-----BEGIN RSA PRIVATE KEY-----</span>
  <span class="s">your_private_key_here</span>
  <span class="s">-----END RSA PRIVATE KEY-----</span>

<span class="na">jwt_public_key</span><span class="pi">:</span> <span class="pi">|</span>
  <span class="s">-----BEGIN PUBLIC KEY-----</span>
  <span class="s">your_public_key_here</span>
  <span class="s">-----END PUBLIC KEY-----</span>
</code></pre></div></div>

<h3 id="2-configure-devise-jwt-for-rs256">2. Configure Devise-JWT for RS256</h3>

<p>Update your <code class="language-plaintext highlighter-rouge">config/initializers/devise.rb</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Devise</span><span class="p">.</span><span class="nf">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">jwt</span> <span class="k">do</span> <span class="o">|</span><span class="n">jwt</span><span class="o">|</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">algorithm</span>  <span class="o">=</span> <span class="s1">'RS256'</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">secret</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
      <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">jwt_private_key</span>
    <span class="p">)</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">public_key</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
      <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">jwt_public_key</span>
    <span class="p">)</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">dispatch_requests</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">[</span><span class="s1">'POST'</span><span class="p">,</span> <span class="sr">%r{^/api/v1/sessions/sign_in$}</span><span class="p">],</span>
      <span class="p">[</span><span class="s1">'POST'</span><span class="p">,</span> <span class="sr">%r{^/api/v1/users$}</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">revocation_requests</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">[</span><span class="s1">'DELETE'</span><span class="p">,</span> <span class="sr">%r{^/api/v1/sessions/sign_out$}</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">jwt</span><span class="p">.</span><span class="nf">expiration_time</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="nf">day</span><span class="p">.</span><span class="nf">to_i</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="3-configure-doorkeeper-jwt-optional-if-using-oauth2">3. Configure Doorkeeper-JWT (Optional, if using OAuth2)</h3>

<p>Ensure Doorkeeper-JWT issues tokens using the same RSA key:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/initializers/doorkeeper_jwt.rb</span>
<span class="no">Doorkeeper</span><span class="o">::</span><span class="no">JWT</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span>
  <span class="n">token_payload</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="ss">:resource_owner_id</span><span class="p">])</span>
    <span class="p">{</span>
      <span class="ss">iss: </span><span class="s1">'my-rails-api'</span><span class="p">,</span>
      <span class="ss">sub: </span><span class="n">user</span><span class="p">.</span><span class="nf">id</span><span class="p">,</span>
      <span class="ss">email: </span><span class="n">user</span><span class="p">.</span><span class="nf">email</span><span class="p">,</span>
      <span class="ss">scope: </span><span class="n">opts</span><span class="p">[</span><span class="ss">:scopes</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">secret_key</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span>
    <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">credentials</span><span class="p">.</span><span class="nf">jwt_private_key</span>
  <span class="p">)</span>
  <span class="n">encryption_method</span> <span class="ss">:rs256</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="4-verify-rsa-based-jwt">4. Verify RSA-based JWT</h3>

<p>Your application now automatically issues and verifies JWT tokens using RSA keys. Token verification uses only the public key, keeping your private key secret and secure.</p>

<hr />

<h2 id="key-rotation">Key Rotation</h2>

<p>To rotate keys without downtime:</p>

<ol>
  <li>Generate a new RSA key pair.</li>
  <li>Temporarily add the new public key to your application’s configuration alongside the old one.</li>
  <li>Issue tokens with the new private key; verify tokens with both old and new public keys.</li>
  <li>After all older tokens expire, remove the old keys.</li>
</ol>

<p>Example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jwt</span><span class="p">.</span><span class="nf">public_key_set</span> <span class="o">=</span> <span class="p">[</span>
  <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">new_public_key</span><span class="p">),</span>
  <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKey</span><span class="o">::</span><span class="no">RSA</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">old_public_key</span><span class="p">)</span>
<span class="p">]</span>
</code></pre></div></div>

<hr />

<h2 id="test-via-curl">Test via cURL</h2>

<p>Sign-in example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-X</span> POST http://localhost:3000/api/v1/sessions/sign_in <span class="se">\</span>
<span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
<span class="nt">-d</span> <span class="s1">'{"user":{"email":"alice@example.com","password":"password123"}}'</span>
</code></pre></div></div>

<p>The response includes an RSA-signed JWT:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authorization: Bearer eyJhbGciOiJSUzI1NiJ9...
</code></pre></div></div>

<hr />

<p><strong>Conclusion</strong></p>

<p>Switching to RSA keys (<code class="language-plaintext highlighter-rouge">RS256</code>) strengthens JWT token security in your Rails API, clearly separating token generation and verification responsibilities and simplifying key management at scale.</p>

  </div>

  <!-- Post footer -->
  <footer style="margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border);">
    <a href="/blog" class="back-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"/>
        <polyline points="12 19 5 12 12 5"/>
      </svg>
      <span>Back to all posts</span>
    </a>
  </footer>
</article>

    </main>

    <footer class="site-footer">
      <div style="display: flex; align-items: center; justify-content: center; gap: 1.5rem; flex-wrap: wrap;">
  <a href="https://lukin.io/cv.pdf" target="_blank" title="Download CV" style="display: inline-flex; align-items: center; gap: 0.5rem;">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="7 10 12 15 17 10"/>
      <line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
    <span>Download CV</span>
  </a>
  <span style="opacity: 0.5;">·</span>
  <button id="theme-btn" onclick="toggleTheme()" class="theme-toggle-btn" title="Toggle light & dark theme" aria-label="Toggle theme" aria-live="polite">
    <!-- Moon icon (shown in light mode) -->
    <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"/>
    </svg>
    <!-- Sun icon (shown in dark mode) -->
    <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"/>
      <path d="M6.343 17.657l-1.414 1.414"/>
      <path d="M6.343 6.343l-1.414 -1.414"/>
      <path d="M17.657 6.343l1.414 -1.414"/>
      <path d="M17.657 17.657l1.414 1.414"/>
      <path d="M4 12h-2"/>
      <path d="M12 4v-2"/>
      <path d="M20 12h2"/>
      <path d="M12 20v2"/>
    </svg>
  </button>
</div>

    </footer>
  </div>

  <script>
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      // Use View Transitions API if available
      if (document.startViewTransition) {
        document.startViewTransition(() => {
          html.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      } else {
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }
    }
  </script>
</body>
</html>
