<!DOCTYPE html>
<html lang="en">
<head>
  <!-- View Transitions API -->
  <meta name="view-transition" content="same-origin">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VLFHH5CPGM"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-VLFHH5CPGM');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Zero-Gap API Development: A Contract-First Framework for AI-Assisted Rails Engineering | Software Engineering consultant</title>
  
  <meta name="theme-color" content="#006cac">

  <link rel="canonical" href="http://localhost:4000/blog/zero-gap-api-development-with-ai">
  <link rel="alternate" type="application/rss+xml" title="Software Engineering consultant" href="http://localhost:4000/feed.xml" />
  <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="/assets/css/global.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/typography.css">

  <meta name="description"
    content="  TL;DR      Contract-first development with TypeScript interfaces as the single source of truth eliminates ambiguity and prevents frontend/backend drift.   ...">
  <meta name="keywords"
    content="Software Engineering consultant, programming consultant, Ruby web development, agile Ruby development, Ruby on Rails web design, RoR consulting, Ruby on Rails service, RoR consultant, Ruby on Rails NYC, Ruby on Rails expertise, web agency, ios application development, mobile, api, frontend, backend, development, software engineer partner, sf developer, sf ruby on rails, berling ruby consultant, london consultant">
  <meta name="author" content="Max Lukin">

  <!-- Theme initialization - prevent flash -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    })();
  </script>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Zero-Gap API Development: A Contract-First Framework for AI-Assisted Rails Engineering | Software Engineering consultant</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Zero-Gap API Development: A Contract-First Framework for AI-Assisted Rails Engineering" />
<meta name="author" content="Max Lukin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A complete framework for shipping regression-free Rails APIs with AI assistants—combining contract-first development, systematic verification, and gap-free documentation." />
<meta property="og:description" content="A complete framework for shipping regression-free Rails APIs with AI assistants—combining contract-first development, systematic verification, and gap-free documentation." />
<link rel="canonical" href="http://localhost:4000/blog/zero-gap-api-development-with-ai" />
<meta property="og:url" content="http://localhost:4000/blog/zero-gap-api-development-with-ai" />
<meta property="og:site_name" content="Software Engineering consultant" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-12-02T00:00:00+05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Zero-Gap API Development: A Contract-First Framework for AI-Assisted Rails Engineering" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Max Lukin"},"dateModified":"2025-12-02T00:00:00+05:00","datePublished":"2025-12-02T00:00:00+05:00","description":"A complete framework for shipping regression-free Rails APIs with AI assistants—combining contract-first development, systematic verification, and gap-free documentation.","headline":"Zero-Gap API Development: A Contract-First Framework for AI-Assisted Rails Engineering","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/zero-gap-api-development-with-ai"},"url":"http://localhost:4000/blog/zero-gap-api-development-with-ai"}</script>
<!-- End Jekyll SEO tag -->

</head>


<body>
  <!-- Main content wrapper -->
  <div class="main-wrapper centered">
    <main>
      <!-- Reading progress bar -->
<div class="reading-progress" id="reading-progress"></div>

<article class="post-article">
  <!-- Back navigation -->
  <a href="/blog" class="back-home">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1m2 13a2 2 0 0 1-2-2V7m2 13a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2m-4-3H9M7 16h6M7 12h10"/>
    </svg>
    <span>Blog</span>
  </a>

  <!-- Post header -->
  <header class="post-header">
    <h1 class="post-title">Zero-Gap API Development: A Contract-First Framework for AI-Assisted Rails Engineering</h1>
    <div class="post-meta">
      <time datetime="2025-12-02T00:00:00+05:00">Dec 2, 2025</time>
      
      
      
      <span>· 12 min read</span>
      
        <span>· Max Lukin</span>
      
      
        <span class="post-tags"><a href="/search?q=ai" class="tag">ai</a><a href="/search?q=software-engineering" class="tag">software-engineering</a><a href="/search?q=rails" class="tag">rails</a><a href="/search?q=api" class="tag">api</a><a href="/search?q=blueprinter" class="tag">blueprinter</a><a href="/search?q=rspec" class="tag">rspec</a><a href="/search?q=cursor" class="tag">cursor</a><a href="/search?q=contracts" class="tag">contracts</a><a href="/search?q=documentation" class="tag">documentation</a></span>
      
    </div>
  </header>

  <div class="post-body">
    <!-- Table of Contents (generated by JS for posts with 4+ headings) -->
    <aside class="toc-sidebar" id="toc-sidebar">
      <nav class="toc" id="toc">
        <div class="toc-title">Contents</div>
        <ul class="toc-list" id="toc-list"></ul>
      </nav>
    </aside>

    <!-- Post content -->
    <div class="prose post-content" id="post-content">
      <blockquote>
  <p><strong>TL;DR</strong></p>

  <ul>
    <li><strong>Contract-first development</strong> with TypeScript interfaces as the single source of truth eliminates ambiguity and prevents frontend/backend drift.</li>
    <li><strong>Systematic verification gates</strong> catch implementation gaps before they ship—not after.</li>
    <li><strong>Discrepancy classification</strong> (<code class="language-plaintext highlighter-rouge">[IMPL]</code> vs <code class="language-plaintext highlighter-rouge">[DOC]</code>) ensures you fix what’s broken and flag what’s misaligned.</li>
    <li><strong>Mandatory dual documentation</strong> (Flow + PRD) creates institutional memory that survives team changes.</li>
  </ul>
</blockquote>

<p>This post is the evolution of our previous guides on <a href="/2025-09-09-consolidating-rails-api-guide-for-cursor-ide">consolidating Rails contribution standards</a> and <a href="/2025-10-29-ai-senior-vs-junior">senior-driven AI development</a>. After shipping dozens of endpoints with zero regressions, we’ve refined the process into a complete framework.</p>

<hr />

<h2 id="the-problem-death-by-a-thousand-gaps">The Problem: Death by a Thousand Gaps</h2>

<p>Every API project eventually faces the same failure modes:</p>

<ol>
  <li><strong>Contract drift</strong>: Backend returns <code class="language-plaintext highlighter-rouge">userId</code>, frontend expects <code class="language-plaintext highlighter-rouge">user_id</code></li>
  <li><strong>Silent regressions</strong>: v1.1 breaks v1.0 behaviors nobody tested</li>
  <li><strong>Incomplete implementations</strong>: 8 of 10 required fields shipped, 2 “forgot”</li>
  <li><strong>Documentation rot</strong>: Flow docs describe behavior from 3 sprints ago</li>
  <li><strong>AI amplification</strong>: LLMs generate plausible-looking code that fails edge cases</li>
</ol>

<p>The root cause isn’t carelessness—it’s <strong>missing systematic verification</strong>. Humans (and AIs) make errors. Systems catch them.</p>

<hr />

<h2 id="the-solution-three-layer-architecture">The Solution: Three-Layer Architecture</h2>

<p>Our framework operates on three layers, each with a specific purpose:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────────────────────────────────────────────────────┐
│  Layer 1: REQUIREMENT_DOC (doc/requirements/**)         │
│  - TypeScript interfaces = canonical truth              │
│  - Read-only, never modified by implementers            │
│  - Versioned (v1.0, v1.1, v1.2...)                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  Layer 2: Implementation (app/**, spec/**)              │
│  - Must satisfy ALL versions cumulatively               │
│  - Blueprinter for JSON, Pundit for auth                │
│  - Contract Compliance Verification before merge        │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│  Layer 3: Documentation (doc/flow/**, doc/prd/**)       │
│  - Generated AFTER verification passes                  │
│  - Reflects actual implementation, not intent           │
│  - Version history preserved, never overwritten         │
└─────────────────────────────────────────────────────────┘
</code></pre></div></div>

<hr />

<h2 id="layer-1-contract-first-development">Layer 1: Contract-First Development</h2>

<p>The REQUIREMENT_DOC is the <strong>single source of truth</strong>. It contains TypeScript interfaces that define the exact response shape:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// doc/requirements/PROFILE_CARD.md</span>
<span class="kr">interface</span> <span class="nx">ProfileCard</span> <span class="p">{</span>
  <span class="nl">id</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>                    <span class="c1">// required</span>
  <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>              <span class="c1">// required</span>
  <span class="nl">avatar_url</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>     <span class="c1">// optional</span>
  <span class="nl">skills</span><span class="p">:</span> <span class="nx">Skill</span><span class="p">[];</span>               <span class="c1">// required, min 0 items</span>
  <span class="nl">availability</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">now</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">two_weeks</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">offer</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">na</span><span class="dl">'</span><span class="p">;</span>
    <span class="nl">updated_at</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>          <span class="c1">// ISO8601</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>The rules are simple:</strong></p>

<ol>
  <li>Every field in the interface <strong>must</strong> exist in your Blueprint</li>
  <li>Required fields <strong>never</strong> return <code class="language-plaintext highlighter-rouge">null</code>—use safe defaults</li>
  <li>No extra fields beyond what’s documented</li>
  <li>Version changes are <strong>cumulative</strong> unless explicitly marked as breaking</li>
</ol>

<h3 id="safe-defaults-strategy">Safe Defaults Strategy</h3>

<p>When database data is sparse, required fields still must satisfy the contract:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># app/blueprints/profile_card_blueprint.rb</span>
<span class="k">class</span> <span class="nc">ProfileCardBlueprint</span> <span class="o">&lt;</span> <span class="no">Blueprinter</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">identifier</span> <span class="ss">:id</span>

  <span class="n">field</span> <span class="ss">:username</span> <span class="k">do</span> <span class="o">|</span><span class="n">profile</span><span class="o">|</span>
    <span class="n">profile</span><span class="p">.</span><span class="nf">username</span><span class="p">.</span><span class="nf">presence</span> <span class="o">||</span> <span class="s2">""</span>  <span class="c1"># String → empty string</span>
  <span class="k">end</span>

  <span class="n">field</span> <span class="ss">:skills</span> <span class="k">do</span> <span class="o">|</span><span class="n">profile</span><span class="o">|</span>
    <span class="n">profile</span><span class="p">.</span><span class="nf">skills</span><span class="p">.</span><span class="nf">presence</span> <span class="o">||</span> <span class="p">[]</span>    <span class="c1"># Array → empty array</span>
  <span class="k">end</span>

  <span class="n">field</span> <span class="ss">:availability</span> <span class="k">do</span> <span class="o">|</span><span class="n">profile</span><span class="o">|</span>
    <span class="p">{</span>
      <span class="ss">status: </span><span class="n">profile</span><span class="p">.</span><span class="nf">availability_status</span> <span class="o">||</span> <span class="s2">"na"</span><span class="p">,</span>  <span class="c1"># Enum → default value</span>
      <span class="ss">updated_at: </span><span class="p">(</span><span class="n">profile</span><span class="p">.</span><span class="nf">availability_updated_at</span> <span class="o">||</span> <span class="no">Time</span><span class="p">.</span><span class="nf">current</span><span class="p">).</span><span class="nf">iso8601</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p><strong>Safe defaults by type:</strong></p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>String (required)</td>
      <td><code class="language-plaintext highlighter-rouge">""</code> (empty string)</td>
    </tr>
    <tr>
      <td>Number (required)</td>
      <td><code class="language-plaintext highlighter-rouge">0</code> or minimum valid value</td>
    </tr>
    <tr>
      <td>Boolean (required)</td>
      <td><code class="language-plaintext highlighter-rouge">false</code></td>
    </tr>
    <tr>
      <td>Array (required)</td>
      <td><code class="language-plaintext highlighter-rouge">[]</code> (empty array)</td>
    </tr>
    <tr>
      <td>Object (required)</td>
      <td>Minimal valid object with nested defaults</td>
    </tr>
    <tr>
      <td>Timestamp</td>
      <td><code class="language-plaintext highlighter-rouge">Time.current.iso8601</code></td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="layer-2-implementation-with-verification-gates">Layer 2: Implementation with Verification Gates</h2>

<h3 id="the-verification-checklist">The Verification Checklist</h3>

<p>Every implementation must pass these gates <strong>in order</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. Code quality</span>
bundle <span class="nb">exec </span>rubocop

<span class="c"># 2. Test suite (establishes baseline, catches regressions)</span>
bundle <span class="nb">exec </span>rspec

<span class="c"># 3. Security scan</span>
bundle <span class="nb">exec </span>brakeman <span class="nt">-q</span> <span class="nt">-w2</span>

<span class="c"># 4. Dependency audit</span>
bundle <span class="nb">exec </span>bundle audit check <span class="nt">--update</span>

<span class="c"># 5. API documentation generation</span>
bundle <span class="nb">exec </span>rails rswag:specs:swaggerize
</code></pre></div></div>

<p><strong>If any gate fails, stop and fix.</strong> Do not proceed to documentation.</p>

<h3 id="contract-compliance-verification-no-gaps">Contract Compliance Verification (NO GAPS)</h3>

<p>After all tests pass, systematically audit against REQUIREMENT_DOC:</p>

<p><strong>1. Endpoints Audit</strong></p>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Every path in REQUIREMENT_DOC exists in routes</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />HTTP methods match (GET/POST/PATCH/DELETE)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />URL and query params match documented names</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Auth requirements match (public vs authenticated, role restrictions)</li>
</ul>

<p><strong>2. Response Shape Audit</strong></p>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Every field in TypeScript interface exists in Blueprint</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />No extra fields emitted beyond REQUIREMENT_DOC</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Required fields never return null/nil</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Nested objects match documented structure exactly</li>
</ul>

<p><strong>3. Validation &amp; Error Audit</strong></p>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />All documented validations implemented</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Error responses use correct status codes:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">422</code> → Validation errors (<code class="language-plaintext highlighter-rouge">:unprocessable_content</code>)</li>
      <li><code class="language-plaintext highlighter-rouge">400</code> → Bad request / malformed params</li>
      <li><code class="language-plaintext highlighter-rouge">401</code> → Unauthorized (missing/invalid auth)</li>
      <li><code class="language-plaintext highlighter-rouge">403</code> → Forbidden (authenticated but not permitted)</li>
      <li><code class="language-plaintext highlighter-rouge">404</code> → Not found</li>
    </ul>
  </li>
</ul>

<p><strong>4. Version Compliance Audit</strong></p>
<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />v1.0 requirements still satisfied</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />v1.1+ additions implemented correctly</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Breaking changes only where REQUIREMENT_DOC explicitly declares</li>
</ul>

<h3 id="discrepancy-classification">Discrepancy Classification</h3>

<p>When gaps are found, classify them correctly:</p>

<p><strong>Type A: Implementation Issues</strong> — Your code doesn’t match REQUIREMENT_DOC</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[IMPL] GET /profiles/:id - [EXPECTED: returns avatar_url] vs [ACTUAL: field missing from Blueprint]
[IMPL] POST /users - [EXPECTED: 422 for invalid email] vs [ACTUAL: returns 400]
</code></pre></div></div>

<p>→ <strong>Fix ALL before proceeding.</strong> Re-run verification after fixes.</p>

<p><strong>Type B: Requirement Doc Discrepancies</strong> — REQUIREMENT_DOC doesn’t match existing DB/model</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[DOC] visible_within enum - [DOC: 'local'|'state'|'country'] vs [DB: '5'|'10'|'25'|'50' miles]
[DOC] Availability.status - [DOC: 'available'|'unavailable'] vs [Model: 'now'|'two_weeks'|'offer'|'na']
</code></pre></div></div>

<p>→ <strong>Do NOT modify <code class="language-plaintext highlighter-rouge">doc/requirements/**</code></strong> (read-only).
→ Blueprint returns actual DB values (correct behavior).
→ Flag for product/doc owner to reconcile.</p>

<hr />

<h2 id="layer-3-mandatory-documentation">Layer 3: Mandatory Documentation</h2>

<p><strong>Both Flow docs and PRDs are mandatory for every task.</strong> Generate only <strong>after</strong> verification passes.</p>

<h3 id="flow-doc-template-web-286-structure">Flow Doc Template (WEB-286 structure)</h3>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># TASK_ID — Feature Name</span>

<span class="gu">## Metadata</span>
<span class="p">-</span> <span class="gs">**Task:**</span> TASK_ID
<span class="p">-</span> <span class="gs">**Status:**</span> Implemented
<span class="p">-</span> <span class="gs">**Version:**</span> 1.0

<span class="gu">## Table of Contents</span>
<span class="p">1.</span> General Description
<span class="p">2.</span> Validation Use Cases
<span class="p">3.</span> Pundit Policy
<span class="p">4.</span> Implementation Notes
<span class="p">5.</span> Status Codes
<span class="p">6.</span> Flow
<span class="p">7.</span> Responsible Files

<span class="gu">## General Description</span>
[What the feature does, who can access it]

<span class="gu">## Validation Use Cases</span>
| Field | Rule | Error Code |
|-------|------|------------|
| email | required, format | 422 |

<span class="gu">## Pundit Policy</span>
<span class="p">-</span> <span class="sb">`index?`</span> → authenticated users
<span class="p">-</span> <span class="sb">`create?`</span> → owner only

<span class="gu">## Status Codes</span>
| Code | Condition |
|------|-----------|
| 200 | Success |
| 422 | Validation failed |
| 403 | Not authorized |

<span class="gu">## Responsible Files</span>
<span class="p">-</span> <span class="sb">`app/controllers/api/v1/items_controller.rb`</span>
<span class="p">-</span> <span class="sb">`app/blueprints/item_blueprint.rb`</span>
<span class="p">-</span> <span class="sb">`app/policies/item_policy.rb`</span>
<span class="p">-</span> <span class="sb">`spec/requests/api/v1/items_spec.rb`</span>
</code></pre></div></div>

<h3 id="prd-template-web-240-structure">PRD Template (WEB-240 structure)</h3>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># TASK_ID — Feature Name PRD</span>

<span class="gu">## Problem Statement</span>
[What problem does this solve?]

<span class="gu">## Goals</span>
<span class="p">-</span> [Goal 1]
<span class="p">-</span> [Goal 2]

<span class="gu">## Scope</span>
<span class="gu">### In Scope</span>
<span class="p">-</span> [Feature A]

<span class="gu">### Out of Scope</span>
<span class="p">-</span> [Feature B]

<span class="gu">## User Stories</span>
<span class="p">-</span> As a [role], I want to [action] so that [benefit]

<span class="gu">## Technical Considerations</span>
<span class="p">-</span> [Database changes]
<span class="p">-</span> [API contract]

<span class="gu">## Metrics</span>
<span class="p">-</span> [How will success be measured?]

<span class="gu">## Rollout Plan</span>
<span class="p">-</span> [Deployment strategy]

<span class="gu">## Dependencies</span>
<span class="p">-</span> [External services, gems, etc.]
</code></pre></div></div>

<h3 id="version-history">Version History</h3>

<p>Both docs must maintain explicit version history:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gu">## Version History</span>

<span class="gu">### Version 1.1 (2025-12-02)</span>
<span class="p">-</span> Added <span class="sb">`avatar_url`</span> field to response
<span class="p">-</span> Changed <span class="sb">`status`</span> enum values

<span class="gu">### Version 1.0 (2025-11-15)</span>
<span class="p">-</span> Initial implementation
</code></pre></div></div>

<p><strong>Never overwrite—always append.</strong></p>

<hr />

<h2 id="the-complete-prompt-template">The Complete Prompt Template</h2>

<p>When using AI assistants, use this universal prompt:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Task: TASK_ID – FEATURE_LABEL (Ruby on Rails API)

Context:
- Requirements (single source of truth): REQUIREMENT_DOC
- Flow doc: FLOW_DOC
- PRD doc: PRD_DOC

Global constraints:
- Read and follow AGENTS.md and GUIDE.md before changing anything
- JSON via Blueprinter only; controllers handle envelopes
- Never bypass serializers, never use camelCase keys

Core contract rules:
- TypeScript interfaces in REQUIREMENT_DOC are the ONLY truth
- Required fields never return null (use safe defaults)
- All versions (v1.0, v1.1, ...) satisfied cumulatively

Implementation:
- Upgrade existing code to satisfy ALL versions in REQUIREMENT_DOC
- Do NOT remove behaviors that already match the contract
- Build JSON via Blueprinter with exact field sets

Verification (all must pass):
1. bundle exec rubocop
2. bundle exec rspec
3. bundle exec brakeman -q -w2
4. bundle exec bundle audit check --update
5. bundle exec rails rswag:specs:swaggerize

Contract Compliance (NO GAPS):
- Audit: endpoints, response shape, validations, versions
- Classify discrepancies: [IMPL] = fix code, [DOC] = flag for doc owner

Final documentation (AFTER verification):
- Generate/update FLOW_DOC and PRD_DOC
- Include version history
</code></pre></div></div>

<hr />

<h2 id="controller-patterns-that-work">Controller Patterns That Work</h2>

<h3 id="index-with-pagination">Index with Pagination</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">index</span>
  <span class="n">items</span> <span class="o">=</span> <span class="no">Item</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="ss">:owner</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">created_at: :desc</span><span class="p">)</span>
              <span class="p">.</span><span class="nf">page</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">]).</span><span class="nf">per</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:per_page</span><span class="p">]</span> <span class="o">||</span> <span class="mi">20</span><span class="p">)</span>

  <span class="n">render_collection_envelope</span><span class="p">(</span>
    <span class="ss">collection: </span><span class="n">items</span><span class="p">,</span>
    <span class="ss">blueprint: </span><span class="no">ItemBlueprint</span>
  <span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Response:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">...</span><span class="p">],</span><span class="w">
  </span><span class="nl">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"page"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"per_page"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
    </span><span class="nl">"total_pages"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nl">"total_count"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="create-with-validation">Create with Validation</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
  <span class="n">item</span> <span class="o">=</span> <span class="n">current_user</span><span class="p">.</span><span class="nf">items</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">item_params</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">item</span><span class="p">.</span><span class="nf">save</span>
    <span class="n">render_success_envelope</span><span class="p">(</span>
      <span class="ss">message: </span><span class="s2">"Item created successfully"</span><span class="p">,</span>
      <span class="ss">resource: </span><span class="n">item</span><span class="p">,</span>
      <span class="ss">blueprint: </span><span class="no">ItemBlueprint</span><span class="p">,</span>
      <span class="ss">status: :created</span>
    <span class="p">)</span>
  <span class="k">else</span>
    <span class="n">render_validation_errors</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Success (201):</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Item created successfully"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Validation Error (422):</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Title can't be blank and Price must be greater than 0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"can't be blank"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"must be greater than 0"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr />

<h2 id="spec-coverage-requirements">Spec Coverage Requirements</h2>

<p>Every implementation ships with:</p>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><strong>Request spec</strong> for each endpoint (success + ALL documented error cases)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><strong>RSwag integration spec</strong> for Swagger generation</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><strong>Policy spec</strong> for authorization rules</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><strong>Model spec</strong> for validations/associations/scopes</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" /><strong>Blueprint spec</strong> when output shape is complex</li>
</ul>

<h3 id="regression-prevention">Regression Prevention</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Before modifying existing code:</span>
<span class="c1"># 1. Run existing specs → establish baseline (all green)</span>
<span class="c1"># 2. Make changes</span>
<span class="c1"># 3. Run specs again → ALL prior specs must still pass</span>
<span class="c1"># 4. If any fail, treat as regression and fix before proceeding</span>
</code></pre></div></div>

<hr />

<h2 id="why-this-works">Why This Works</h2>

<table>
  <thead>
    <tr>
      <th>Without Framework</th>
      <th>With Framework</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>“It works on my machine”</td>
      <td>Verification gates catch issues</td>
    </tr>
    <tr>
      <td>Frontend discovers missing fields</td>
      <td>Contract compliance audit prevents gaps</td>
    </tr>
    <tr>
      <td>v1.1 breaks v1.0</td>
      <td>Cumulative version compliance</td>
    </tr>
    <tr>
      <td>Docs are always stale</td>
      <td>Docs generated from actual implementation</td>
    </tr>
    <tr>
      <td>AI generates plausible bugs</td>
      <td>AI follows explicit contracts</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="the-efficiency-multiplier">The Efficiency Multiplier</h2>

<p>This framework turns AI from a liability into an accelerator:</p>

<ol>
  <li><strong>Fewer review cycles</strong> — Envelopes, pagination, and auth are consistent from the start</li>
  <li><strong>Predictable output</strong> — AI synthesizes code that matches contracts</li>
  <li><strong>Lower context cost</strong> — One authoritative source means less ambiguity</li>
  <li><strong>Safer by default</strong> — Verification gates catch errors before merge</li>
  <li><strong>Institutional memory</strong> — Documentation survives team changes</li>
</ol>

<hr />

<h2 id="quick-reference">Quick Reference</h2>

<p><strong>Response Envelopes:</strong></p>
<ul>
  <li>List: <code class="language-plaintext highlighter-rouge">{ data: [...], meta: { page, per_page, total_pages, total_count } }</code></li>
  <li>Success: <code class="language-plaintext highlighter-rouge">{ success: true, message: "...", data: {...} }</code></li>
  <li>Error: <code class="language-plaintext highlighter-rouge">{ error: "...", errors: {...} }</code></li>
</ul>

<p><strong>Status Codes:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">200</code> → OK (read, update, delete)</li>
  <li><code class="language-plaintext highlighter-rouge">201</code> → Created</li>
  <li><code class="language-plaintext highlighter-rouge">400</code> → Bad request</li>
  <li><code class="language-plaintext highlighter-rouge">401</code> → Unauthorized</li>
  <li><code class="language-plaintext highlighter-rouge">403</code> → Forbidden</li>
  <li><code class="language-plaintext highlighter-rouge">404</code> → Not found</li>
  <li><code class="language-plaintext highlighter-rouge">422</code> → Validation failed</li>
</ul>

<p><strong>Discrepancy Tags:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">[IMPL]</code> → Fix your code</li>
  <li><code class="language-plaintext highlighter-rouge">[DOC]</code> → Flag for doc owner</li>
</ul>

<p><strong>Safe Defaults:</strong></p>
<ul>
  <li>String → <code class="language-plaintext highlighter-rouge">""</code></li>
  <li>Number → <code class="language-plaintext highlighter-rouge">0</code></li>
  <li>Boolean → <code class="language-plaintext highlighter-rouge">false</code></li>
  <li>Array → <code class="language-plaintext highlighter-rouge">[]</code></li>
  <li>Timestamp → <code class="language-plaintext highlighter-rouge">Time.current.iso8601</code></li>
</ul>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>Zero-gap development isn’t about perfection—it’s about <strong>systematic verification</strong>. By treating TypeScript interfaces as contracts, running verification gates religiously, and generating documentation from working code, you eliminate entire categories of bugs.</p>

<p>AI amplifies whatever process you give it. Give it contracts, gates, and verification—and it becomes the best pair programmer you’ve ever had.</p>

<p><strong>The framework is the force multiplier. Experience is choosing to use it.</strong></p>


    </div>
  </div>

  <!-- Post navigation (Previous/Next) -->
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      
      
      
      

  <nav class="post-navigation">
    
      <a href="/blog/building-browser-mmorpg-with-rails-and-ai" class="post-nav-link post-nav-prev">
        <span class="post-nav-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"/>
            <polyline points="12 19 5 12 12 5"/>
          </svg>
          Older
        </span>
        <span class="post-nav-title">Building a Browser-Based MMORPG with Ruby on Rails:...</span>
      </a>
    
    
      <a href="/blog/mysql-to-postgresql-migration-guide" class="post-nav-link post-nav-next">
        <span class="post-nav-label">
          Newer
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"/>
            <polyline points="12 5 19 12 12 19"/>
          </svg>
        </span>
        <span class="post-nav-title">From MySQL to PostgreSQL: A Practical Migration Guide...</span>
      </a>
    
  </nav>

  <!-- Back to top button -->
  <button id="back-to-top" class="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="Back to top" aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="19" x2="12" y2="5"/>
      <polyline points="5 12 12 5 19 12"/>
    </svg>
  </button>
</article>

<script>
  // Show/hide back-to-top button based on scroll position
  const backToTop = document.getElementById('back-to-top');
  window.addEventListener('scroll', function() {
    if (window.scrollY > 400) {
      backToTop.classList.add('visible');
    } else {
      backToTop.classList.remove('visible');
    }
  });

  // Reading progress bar
  const progressBar = document.getElementById('reading-progress');
  const article = document.querySelector('.post-article');

  window.addEventListener('scroll', function() {
    const articleTop = article.offsetTop;
    const articleHeight = article.offsetHeight;
    const windowHeight = window.innerHeight;
    const scrolled = window.scrollY - articleTop + windowHeight * 0.3;
    const progress = Math.min(Math.max(scrolled / articleHeight * 100, 0), 100);
    progressBar.style.width = progress + '%';
  });

  // Generate Table of Contents
  const postContent = document.getElementById('post-content');
  const tocList = document.getElementById('toc-list');
  const tocSidebar = document.getElementById('toc-sidebar');
  const headings = postContent.querySelectorAll('h2, h3');

  if (headings.length >= 4) {
    tocSidebar.classList.add('visible');

    headings.forEach((heading, index) => {
      // Add ID to heading if not present
      if (!heading.id) {
        heading.id = 'heading-' + index;
      }

      const li = document.createElement('li');
      li.className = 'toc-item toc-' + heading.tagName.toLowerCase();

      const a = document.createElement('a');
      a.href = '#' + heading.id;
      a.textContent = heading.textContent;
      a.className = 'toc-link';

      li.appendChild(a);
      tocList.appendChild(li);
    });

    // Highlight current section in TOC
    const tocLinks = document.querySelectorAll('.toc-link');

    const observerOptions = {
      rootMargin: '-80px 0px -70% 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          tocLinks.forEach(link => link.classList.remove('active'));
          const activeLink = document.querySelector('.toc-link[href="#' + entry.target.id + '"]');
          if (activeLink) activeLink.classList.add('active');
        }
      });
    }, observerOptions);

    headings.forEach(heading => observer.observe(heading));
  }

  // Add copy buttons and language labels to code blocks
  document.querySelectorAll('.highlight, pre').forEach(element => {
    // Skip if already wrapped or if this is a pre inside a highlight we'll process
    if (element.closest('.code-block-wrapper')) return;
    if (element.tagName === 'PRE' && element.closest('.highlight')) return;

    // Determine what to wrap: the .highlight div or standalone pre
    const highlightDiv = element.classList.contains('highlight') ? element : null;
    const pre = highlightDiv ? highlightDiv.querySelector('pre') : element;
    if (!pre) return;

    const wrapper = document.createElement('div');
    wrapper.className = 'code-block-wrapper';

    // Wrap the highlight div if exists, otherwise wrap pre
    const toWrap = highlightDiv || pre;
    toWrap.parentNode.insertBefore(wrapper, toWrap);
    wrapper.appendChild(toWrap);

    // Detect language from class
    const code = pre.querySelector('code');
    let language = '';

    // Method 1: Check code element class
    if (code && code.className) {
      const match = code.className.match(/language-(\w+)/);
      if (match) language = match[1];
    }

    // Method 2: Check highlight div class (Rouge uses class like "highlight ruby")
    if (!language && highlightDiv) {
      const classes = highlightDiv.className.split(' ');
      for (const cls of classes) {
        if (cls !== 'highlight' && cls.length > 0 && !cls.startsWith('code')) {
          language = cls;
          break;
        }
      }
    }

    // Method 3: Try to detect from code patterns
    if (!language) {
      const text = pre.textContent.trim();
      if (text.startsWith('#') && !text.startsWith('#!/')) {
        const firstLine = text.split('\n')[0];
        if (firstLine.match(/\.rb$/)) language = 'ruby';
        else if (firstLine.match(/\.py$/)) language = 'python';
        else if (firstLine.match(/\.yml$|\.yaml$/)) language = 'yaml';
      } else if (text.startsWith('//')) {
        language = 'javascript';
      } else if (text.match(/^(RSpec|describe|it|context|let)\b/)) {
        language = 'ruby';
      } else if (text.match(/^(def |class |module |require )/)) {
        language = 'ruby';
      }
    }

    // Create header with language and copy button
    const header = document.createElement('div');
    header.className = 'code-block-header';

    if (language) {
      const langLabel = document.createElement('span');
      langLabel.className = 'code-lang';
      langLabel.textContent = language;
      header.appendChild(langLabel);
    }

    const copyBtn = document.createElement('button');
    copyBtn.className = 'code-copy-btn';
    copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
    copyBtn.onclick = async function() {
      const text = pre.textContent;
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg><span>Copied!</span>';
        copyBtn.classList.add('copied');
        setTimeout(() => {
          copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Copy</span>';
          copyBtn.classList.remove('copied');
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    };
    header.appendChild(copyBtn);

    // Insert header at the start of wrapper (before the highlight/pre)
    wrapper.insertBefore(header, wrapper.firstChild);
  });
</script>

    </main>

    <footer class="site-footer">
      <div class="footer-content">
  <div class="footer-links">
    <a href="/feed.xml" title="RSS Feed" class="footer-icon-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 11a9 9 0 0 1 9 9"/>
        <path d="M4 4a16 16 0 0 1 16 16"/>
        <circle cx="5" cy="19" r="1"/>
      </svg>
    </a>
    <span class="footer-divider">·</span>
    <button id="theme-btn" onclick="toggleTheme()" class="theme-toggle-btn" title="Toggle theme (press T)" aria-label="Toggle theme" aria-live="polite">
      <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"/>
      </svg>
      <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.828 14.828a4 4 0 1 0 -5.656 -5.656a4 4 0 0 0 5.656 5.656z"/>
        <path d="M6.343 17.657l-1.414 1.414"/>
        <path d="M6.343 6.343l-1.414 -1.414"/>
        <path d="M17.657 6.343l1.414 -1.414"/>
        <path d="M17.657 17.657l1.414 1.414"/>
        <path d="M4 12h-2"/>
        <path d="M12 4v-2"/>
        <path d="M20 12h2"/>
        <path d="M12 20v2"/>
      </svg>
    </button>
  </div>
</div>

    </footer>
  </div>

  <script>
    // Theme toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      // Use View Transitions API if available
      if (document.startViewTransition) {
        document.startViewTransition(() => {
          html.setAttribute('data-theme', newTheme);
          localStorage.setItem('theme', newTheme);
        });
      } else {
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      }
    }

    // Keyboard shortcut: press 't' to toggle theme
    document.addEventListener('keydown', function(e) {
      // Don't trigger if user is typing in an input/textarea
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
        return;
      }
      if (e.key === 't' || e.key === 'T') {
        toggleTheme();
      }
    });
  </script>
</body>
</html>
