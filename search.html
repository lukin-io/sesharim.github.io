---
layout: default
permalink: /search
title: Search
---
<div>
  <!-- Back navigation -->
  <a href="/" class="back-home">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
      <polyline points="9 22 9 12 15 12 15 22"/>
    </svg>
    <span>Home</span>
  </a>

  <!-- Page header -->
  <header class="hero">
    <h1>Search</h1>
    <p class="subtitle">Find posts by title or content</p>
  </header>

  <!-- Search input -->
  <div class="search-container">
    <div class="search-input-wrapper">
      <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"/>
        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
      <input type="text" id="search-input" class="search-input" placeholder="Start typing to search..." autocomplete="off" autofocus>
      <kbd class="search-kbd">/</kbd>
    </div>
    <p class="search-hint">Press <kbd>/</kbd> to focus search anywhere on the site</p>
  </div>

  <!-- Search results -->
  <div id="search-results" class="search-results"></div>

  <!-- All posts (hidden, used for search data) -->
  <div id="posts-data" style="display: none;">
    {% for post in site.posts %}
    <article data-title="{{ post.title | escape }}" data-url="{{ post.url | relative_url }}" data-date="{{ post.date | date: '%b %-d, %Y' }}" data-tags="{% for tag in post.tags %}{{ tag }}{% unless forloop.last %},{% endunless %}{% endfor %}" data-excerpt="{{ post.excerpt | strip_html | strip_newlines | escape | truncatewords: 50 }}">
    </article>
    {% endfor %}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');
  const postsData = document.getElementById('posts-data');

  // Build posts array from hidden data
  const posts = Array.from(postsData.querySelectorAll('article')).map(el => ({
    title: el.dataset.title,
    url: el.dataset.url,
    date: el.dataset.date,
    tags: el.dataset.tags ? el.dataset.tags.split(',') : [],
    excerpt: el.dataset.excerpt
  }));

  // Check for query parameter in URL (e.g., ?q=rails)
  const urlParams = new URLSearchParams(window.location.search);
  const initialQuery = urlParams.get('q') || '';

  if (initialQuery) {
    searchInput.value = initialQuery;
    performSearch(initialQuery);
  } else {
    displayResults(posts, '');
  }

  // Search on input
  searchInput.addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase().trim();
    performSearch(query);
  });

  function performSearch(query) {
    query = query.toLowerCase().trim();

    if (!query) {
      displayResults(posts, '');
      return;
    }

    const filtered = posts.filter(post => {
      const titleMatch = post.title.toLowerCase().includes(query);
      const excerptMatch = post.excerpt.toLowerCase().includes(query);
      const tagMatch = post.tags.some(tag => tag.toLowerCase().includes(query));
      return titleMatch || excerptMatch || tagMatch;
    });

    displayResults(filtered, query);
  }

  function displayResults(results, query) {
    if (results.length === 0) {
      searchResults.innerHTML = `
        <div class="search-no-results">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            <line x1="8" y1="8" x2="14" y2="14"/>
            <line x1="14" y1="8" x2="8" y2="14"/>
          </svg>
          <p>No posts found for "${escapeHtml(query)}"</p>
        </div>
      `;
      return;
    }

    const count = query ? `<p class="search-count">${results.length} post${results.length === 1 ? '' : 's'} found</p>` : '';

    const html = results.map(post => `
      <article class="post-preview">
        <h2>
          <a href="${post.url}">${highlightMatch(post.title, query)}</a>
        </h2>
        <div class="post-meta">
          <time>${post.date}</time>
          ${post.tags.length ? post.tags.map(t => `<span class="tag">${t}</span>`).join(' ') : ''}
        </div>
        ${post.excerpt ? `<p class="excerpt">${highlightMatch(post.excerpt, query)}</p>` : ''}
      </article>
    `).join('');

    searchResults.innerHTML = count + html;
  }

  function highlightMatch(text, query) {
    if (!query) return escapeHtml(text);
    const escaped = escapeHtml(text);
    const regex = new RegExp(`(${escapeRegExp(query)})`, 'gi');
    return escaped.replace(regex, '<mark>$1</mark>');
  }

  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  // Global keyboard shortcut: press '/' to focus search
  document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
      // Allow Escape to blur
      if (e.key === 'Escape') {
        searchInput.blur();
      }
      return;
    }
    if (e.key === '/') {
      e.preventDefault();
      searchInput.focus();
      searchInput.select();
    }
  });
});
</script>

